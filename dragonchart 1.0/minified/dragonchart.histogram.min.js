if(!window.DChart){throw new Error('未能加载dragonchart.core.js，该js必须在其他DChart框架的js加载之前被引用。\n'+'Not loaded dragonchart.core.js which must be loaded before other DChart\'s js.');}else{DChart.Const.Skins.BlackAndWhite.Histogram={TopLabelColor:null}}DChart.Histogram=DChart.getCore().__extends({GraphType:'Histogram',SetDefaultOptions:function(){this._resetSharedOpions();this.innerOptions=DChart.Methods.Extend(this.originalDefaultOptions,{animateY:true,animateX:true,histogram:{colors:null,length:null,gap:null,useSameColor:true},topLabel:{show:true,content:function(a){if(this.valueType=='d'||this.valueType=='t'){return''}else if(this.valueType=='p'){return a.percent.toFixed(1).toString()+'%'}else{return a.value.toString()}},color:null,fontweight:null,fontsize:null,fontfamily:null}});return this},Draw:function(v,w){var z=this;if(arguments.length===1){if(!DChart.Methods.IsArray(arguments[0])){w=arguments[0];v=undefined}}z.SetOptions(w);z._checkOptions();var A=z.innerOptions;if(!A.animateY&&!A.animateX){A.animation=false}z.SetData(v);z._onStart();z.tempData.notAllowValueNegative=true;z.shapes.histograms=[];var B=z._formatAxisData();var C=z._calculateOutersValid();var D=z._computeAxis(C);var E=z._getDrawableCoordinate();z.coordinates.draw=E;var F=z.ctx;var G=A.shadow.show;var H=G?A.shadow:null;if(H){if(H.blur&&H.offsetY>-H.blur){H.offsetY=-H.blur}}var I=function(a,b,c,d,e,f,g){z.DrawFigures.createRectangleFill(a,b,c,d,e,g||H);if(f&&A.topLabel.show){var h=A.topLabel;var i=typeof h.content=='function'?h.content.call(A,f):'';if(i){var j=a+c/2;var k=h.fontsize||DChart.Methods.CapValue(c/2,18,11);var l=b-k/2;z.DrawFigures.createText(i,j,l,'center',f.fontweight||h.fontweight,f.fontsize||k,h.fontfamily,f.fontcolor||h.color)}}};var J=function(d,f,g,h,i,j,k,l){this.indexX=d;this.indexY=f;this.left=g;this.top=h;this.width=i;this.height=j;this.data=l;this.isHovered=false;this.color=k;this.redraw=function(a){var b=H;if(H&&H.show&&a){b=DChart.Methods.DeepCopy(H);b.color=a}I(this.left,this.top,this.width,this.height,a||this.color,G?this.data:null,b)};this.click=function(e){var a=typeof this.data.click=='function'?this.data.click:(A.click||null);if(a){a(this.data,e)}};if(A.tip.show&&typeof A.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=this.left+this.width/2+5;var b=this.top+this.height/2;this.tip=z._createTip(A.tip.content.call(A,this.data),a,b);if(a+this.tip.clientWidth>D.maxX){z._changeTip(this.tip,a-this.tip.clientWidth)}var c=this;c.tip.onclick=function(e){c.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var K=null;var L=0;var M=(A.histogram.colors&&A.histogram.colors.length>0?A.histogram.colors:null)||DChart.Const.Defaults.FillColors;z.tempData.legendColors=M;var N=B.vValueType=='p';var O=function(c,d){if(B.multiple&&!L){var e=A.histogram.gap;if(e&&e>0){var f=(D.labelDistance-B.demanCount*2)/(B.demanCount+1);L=Math.min(e,f)}else{L=D.labelDistance/20}}if(!K){var g=A.histogram.length;if(g&&g>0){var h=B.multiple?((D.labelDistance-(B.demanCount+1)*L)/B.demanCount):D.labelDistance*0.8;K=Math.min(g,h)}else{K=(D.labelDistance-(B.demanCount+1)*L)/(B.multiple?(B.demanCount+0.5):1.5)}}var j=function(a){var b=(A.animateY?c:1)*(D.maxY-D.minY)*z._getFormatDiff(B.vValueType,B.vMinValue,a)/z._getFormatDiff(B.vValueType,B.vMinValue,B.vMaxValue);return b};z.coordinates.histograms=[];for(var i=0,item;item=z.innerData[i];i++){var l=(A.animateX?c:1)*K;if(B.multiple){var m=item.color||M[i%M.length];var n=N?item.percent:item.value;for(var k=0;k<n.length;k++){var o=n[k];var p=B.demanCount/2-i;var q=D.startPos+D.labelDistance*k-p*K-(p-0.5)*L;var r=j(o);var s=D.maxY-r;if(d>=1){var t={click:item.click,mouseover:item.mouseover,mouseleave:item.mouseleave,text:item.text,indexX:k,indexY:i,fontsize:item.fontsize,fontcolor:item.fontcolor,fontweight:item.fontweight};if(N){t.percent=o;t.value=item.value[k]}else{t.value=o}var u=new J(k,i,q,s,l,r,m,t);z.shapes.histograms.push(u);I(q,s,l,r,m,t);if(!z.coordinates.histograms[k]){z.coordinates.histograms[k]=[]}z.coordinates.histograms[k][i]={left:q,top:s,width:l,height:r,color:m}}else{I(q,s,l,r,m)}}}else{var q=D.startPos+D.labelDistance*i-K/2;var r=j(N?item.percent:item.value);var s=D.maxY-r;var m=item.color||(A.histogram.useSameColor?'rgba(69,114,167,1)':M[i%M.length]);if(d>=1){item.indexX=i;item.indexY=1;var u=new J(i,1,q,s,l,r,m,item);z.shapes.histograms.push(u);I(q,s,l,r,m,item);z.coordinates.histograms[i]={left:q,top:s,width:l,height:r,color:m}}else{I(q,s,l,r,m)}}}};var P=function(){var h=function(x,y){var a=null;for(var i=0,shape;shape=z.shapes.histograms[i];i++){if(shape.left<=x&&shape.left+shape.width>=x&&shape.top<=y&&shape.top+shape.height>=y){a=shape;break}}return a};z.canvas.onclick=function(e){var e=window.event||e;var a=z._getMouseLoction(e);var b=h(a.X,a.Y);if(b){b.click(e)}};z.canvas.onmousemove=function(e){var e=window.event||e;var a=z._getMouseLoction(e);var b=h(a.X,a.Y);if(z.tempData.currentMouseShape!=b){var c=z.tempData.currentMouseShape;if(c){var d=typeof c.data.mouseleave=='function'?c.data.mouseleave:(A.mouseleave||null);if(d){d(c.data,e)}}z.tempData.currentMouseShape=b;if(G){z._clearDrawable(E);z._createScales(C)}for(var i=0,c;c=z.shapes.histograms[i];i++){if(c!=b&&(G||c.isHovered)){c.isHovered=false;c.redraw();if(c.hideTip){c.hideTip()}}}if(b){b.isHovered=true;if(A.mouseoverChangeCursor){z.canvas.style.cursor='pointer'}b.redraw();var f=A.mouseoverTransparency;b.redraw('rgba(255,255,255,'+(f>0&&f<1?f:0.2)+')');if(b.showTip){b.showTip()}var g=typeof b.data.mouseover=='function'?b.data.mouseover:(A.mouseover||null);if(g){g(b.data,e)}}else{if(A.mouseoverChangeCursor){z.canvas.style.cursor='auto'}}}}};z._startDrawAndAnimation(O,P)},_spreadSkin:function(a,b){var c=DChart.Const.Skins;if(c[a]&&c[a].Histogram){var d=c[a].Histogram;b.topLabel={};b.topLabel.color=d.TopLabelColor||null}},_getCheckOptions:function(){return{__top:[['animateY','b'],['animateX','b']],histogram:[['colors','ca'],['length','n'],['gap','n'],['useSameColor','b']],topLabel:[['show','b'],['content','f'],['color','c'],['fontweight','s'],['fontsize','n'],['fontfamily','s']]}}});