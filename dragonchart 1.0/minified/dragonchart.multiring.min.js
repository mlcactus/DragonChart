if(!window.DChart){throw new Error('未能加载dragonchart.core.js，该js必须在其他DChart框架的js加载之前被引用。\n'+'Not loaded dragonchart.core.js which must be loaded before other DChart\'s js.');}else{DChart.Const.Skins.BlackAndWhite.MultiRing={SepareateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:'rgba(255,255,255,0.3)'}}DChart.MultiRing=DChart.getCore().__extends({GraphType:'MultiRing',SetDefaultOptions:function(){this._resetSharedOpions();this.innerOptions=DChart.Methods.Extend(this.originalDefaultOptions,{radius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,lengths:null,labels:null,separeateLine:{show:true,color:null,width:null},innerLabel:{show:true,content:function(a){return a.percent.toFixed(1)+'%'},color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(a){return a.text},withlegend:true,legendtype:null,length:null,color:null,backcolor:'rgba(255,255,255,0.3)',bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null},tip:{content:function(a){return'<div>'+(a.label?a.label+'<br/>':'&nbsp;')+a.text+'<br/>value：'+a.value.toString()+'<br/>percent：'+a.percent.toFixed(1)+'%</div>'}}});return this},Draw:function(z,A){var B=this;if(arguments.length===1){if(!DChart.Methods.IsArray(arguments[0])){A=arguments[0];z=undefined}}B.SetOptions(A);B._checkOptions();var C=B.innerOptions;if(!C.animateRotate&&!C.animateScale){C.animation=false}B.SetData(z);var D=DChart.Const.Language[B.Language];var E=B.innerData;var F=E[0].value.length;var G=E.length;if(!F||F<1){throw new Error(D.WrongData+D.DataMustBeMultipleArray);}B._onStart();var H=B._getDrawableCoordinate();var I=DChart.Methods.IsNumber(C.margin)&&C.margin>0?C.margin:15;var J=Math.min((H.maxX-H.minX)/3,(H.maxY-H.minY)/2)-I*2;var K=(C.colors&&C.colors.length>0?C.colors:null)||DChart.Const.Defaults.FillColors;var L=C.labels&&C.labels.length>0?C.labels:[''];B.tempData.legendColors=K;var M=C.lengths&&C.lengths.length>0?C.lengths:null;var N=C.radius&&C.radius<J?C.radius:J;var O=C.separeateLine.show?(C.separeateLine.width||0.5):0;var P=[];for(var k=0;k<F;k++){var Q=0;for(var i=0,item;item=B.innerData[i];i++){var R=item.value[k];if(typeof R!='number'||R<0){throw new Error(D.WrongData+'\''+R+'\''+D.DataMustGreaterThanZero);}Q+=R}P[k]=Q}if(M){var S=0;for(var k=0;k<F;k++){var T=M[k%M.length];S+=T}if(S>N){throw new Error(D.WrongSet+D.SumOfLengthsMustBeLessThanRadius);}}B.coordinates.draw=H;B.coordinates.multiRing={radius:N,centerX:H.centerX,centerY:H.centerY};B.coordinates.multiRing.cemicircles=[];B.coordinates.multiRing.outerlabels=[];B.shapes.cemicircles=[];B.shapes.outerLabels=[];var U=3;var V=3;var W=true;var X=B.ctx;var Y=function(f,g,h,i,j,k){this.index=f;this.angleMin=g;this.angleMax=h;this.innerRadius=i;this.outerRadius=j;this.data=k;this.isHovered=false;this.color=function(){return this.data.color||K[this.index%K.length]};this.redraw=function(a){ba(1,this.innerRadius,this.outerRadius,this.angleMin,this.angleMax,a||this.color())};this.click=function(e){var a=typeof this.data.click=='function'?this.data.click:(C.click||null);if(a){a(this.data,e)}};if(C.tip.show&&typeof C.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=(this.angleMin+this.angleMax)/2;var b=H.centerX+(this.outerRadius+this.innerRadius)/2*Math.cos(a);var c=H.centerY+(this.outerRadius+this.innerRadius)/2*Math.sin(a);this.tip=B._createTip(C.tip.content(this.data),b,c);var d=this;d.tip.onclick=function(e){d.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var Z=function(j,k,l,m,n,o,p,q){this.content=j;this.length=k;this.width=l;this.height=m;this.floatright=n;this.floattop=o;this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2};this.data=p;this.contact=q;this.color=function(){return this.contact.color()};this.index=function(){return this.contact.index};this.resetposition=function(){var a=this.length;var b=H.centerX;var c=H.centerY;var d=(this.contact.angleMin+this.contact.angleMax)/2;var e=Math.cos(d);var f=Math.sin(d);var g=1.15;var h=e>0?1+e:0;var i=f>0?f:0;this.startX=b+N*e;this.startY=c+N*f;this.left=b+N*g*e+(this.floatright?0:-this.width);this.top=c+N*g*f+i*a-a-V}};var ba=function(a,b,c,d,e,f,g,h,i){var j=(d+e)/2;var k=H.centerX;var l=H.centerY;var m=Math.cos(j);var n=Math.sin(j);X.save();X.beginPath();X.moveTo(k+c*a*Math.cos(d),l+c*a*Math.sin(d));X.arc(k,l,c*a,d,e);X.lineTo(k+b*a*Math.cos(e),l+b*a*Math.sin(e));X.arc(k,l,b*a,e,d,true);X.closePath();X.fillStyle=f;X.fill();X.restore();if(C.separeateLine.show){X.save();X.lineWidth=O;X.strokeStyle=C.separeateLine.color||C.lineColor||'#ffffff';X.stroke();X.restore()}if(g){var o=C.outerLabel;if(!(h&&o.show&&typeof o.content=='function')){return}var p=o.length||N/12;X.save();var q=DChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,j);var r=DChart.Methods.JudgeBetweenAngle(-Math.PI,0,j);var s=o.content(h);X.textAlign=q?'left':'right';X.font=(o.fontsize||(p-1))+'px '+(o.fontfamily||C.fontFamily||DChart.Const.Defaults.FontFamily);var t=X.measureText(s).width;X.restore();var u=t+(o.withlegend?p+3*U:2*U);var v=p+V*2;var w=new Z(s,p,u,v,q?1:0,r?1:0,h,i);B.shapes.outerLabels.push(w);i.contact=w}};var bb=function(g){var h=C.innerLabel;if(!(h.show&&typeof h.content=='function')){return}var j=function(a){var b=(a.angleMin+a.angleMax)/2;var c=a.data;var d=(a.innerRadius+a.outerRadius)/2;var e=H.centerX+d*Math.cos(b);var f=H.centerY+d*Math.sin(b);B.DrawFigures.createText(h.content(c),e,f,'center',c.fontweight,c.fontsize||h.fontsize||DChart.Methods.CapValue((a.outerRadius-a.innerRadius)/3,15,11),h.fontfamily,c.fontcolor||h.color||DChart.Const.Defaults.InnerLabelColor)};if(g){j(g)}else{for(var i=0,shape;shape=B.shapes.cemicircles[i];i++){j(shape)}}};var bc=function(l,m){var n=C.outerLabel;if(!(n.show&&typeof n.content=='function')){return}if(W){for(var i=0,shape;shape=B.shapes.outerLabels[i];i++){shape.resetposition()}W=false}var o=function(){var c=function(a,b){return Math.max(a.left,b.left)<=Math.min(a.left+a.width,b.left+b.width)&&Math.max(a.top,b.top)<=Math.min(a.top+a.height,b.top+b.height)};var d=[];var e=[];var f=[];var g=[];for(var i=0,shape;shape=B.shapes.outerLabels[i];i++){while(H.minY>shape.top){shape.top+=V;shape.left+=shape.floatright?U:-U}while(H.maxY<shape.top+shape.height){shape.top-=V;shape.left+=shape.floatright?U:-U}if(shape.floatright&&shape.floattop){f.push(shape)}else if(shape.floatright&&!shape.floattop){g.push(shape)}else if(!shape.floatright&&shape.floattop){d.push(shape)}else{e.push(shape)}}var h=0;var j=[];var k=function(r){if(j.length>0){for(var i=0,compare;compare=j[i];i++){while(c(compare,r)&&h<1000){r.top+=r.floattop?V:-V;r.left+=r.floatright?U:-U;h++}}}j.push(r)};for(var i=d.length-1;i>=0;i--){k(d[i])}j=[];for(var i=0;i<e.length;i++){k(e[i])}j=[];for(var i=0;i<f.length;i++){k(f[i])}j=[];for(var i=g.length-1;i>=0;i--){k(g[i])}};var p=function(a,b){var c=a;if(!b){B.DrawFigures.createQuadraticCurve(c.startX,c.startY,c.startX*0.8+c.endX()*0.2,c.startY*0.2+c.endY()*0.8,c.endX(),c.endY(),1,n.bordercolor);if(n.backcolor){B.DrawFigures.createRectangleFill(c.left,c.top,c.width,c.height,n.backcolor)}var d=n.fontsize||(c.length-1);var e=c.left+(c.floatright?U+(n.withlegend?c.length+U:0):c.width-U);var f=c.top+c.length/2+d/2+V/2;B.DrawFigures.createText(c.content,e,f,c.floatright?'left':'right',null,d,n.fontfamily,n.color);if(n.borderwidth&&n.borderwidth>0){B.DrawFigures.createRectangleBorder(c.left,c.top,c.width,c.height,n.borderwidth,n.bordercolor)}}if(n.withlegend){var g=n.legendtype||'s';var b=b||c.color();B.DrawFigures.createPointElement(g,c.left+U,c.top+V,c.length,b,g!='x',b,2,g=='x')}};if(l){p(l.contact,m)}else{o();B.coordinates.multiRing.outerlabels.length=0;for(var i=0,shape;shape=B.shapes.outerLabels[i];i++){p(shape);B.coordinates.multiRing.outerlabels[i]={index:shape.contact.index,left:shape.left,top:shape.top,width:shape.width,height:shape.height}}}};var bd=function(a,b){var c=Math.PI*(C.startAngle==null?-0.5:C.startAngle);var d=C.animation&&C.animateScale?a:1;var e=C.animation&&C.animateRotate?a:1;var f=N;for(var k=0;k<F;k++){var g=M?M[k%M.length]:N/(F<=2?2*F:2*F-1);var h=L[k%L.length];var j=f;f-=g;var l=f;var m=c;for(var i=0,item;item=B.innerData[i];i++){var n=item.value[k];var o=(n/P[k])*100;var p=e*(o/100*(Math.PI*2));var q=item.color||K[i%K.length];var r=m;var s=m+p;if(b>=1){var t=i+G*k;var u={index:t,color:q,percent:o,value:n,text:item.text,label:h,click:item.click,mouseover:item.mouseover,mouseleave:item.mouseleave,fontsize:item.fontsize,fontcolor:item.fontcolor,fontweight:item.fontweight};var v=new Y(t,r,s,l,j,u);ba(d,l,j,r,s,q,k==0,u,v);B.shapes.cemicircles.push(v);B.coordinates.multiRing.cemicircles.push({index:t,percent:o,angleMin:r,angleMax:s,innerRadius:l,outerRadius:j})}else{ba(d,l,j,r,s,q)}m+=p}}if(b>=1){bb();bc()}};var be=function(a){a.isHovered=true;if(C.mouseoverChangeCursor){B.canvas.style.cursor='pointer'}var b=C.mouseoverTransparency;a.redraw('rgba(255,255,255,'+(b>0&&b<1?b:0.2)+')');if(a.showTip){a.showTip()}};var bf=function(){var g=function(x,y){var a=null;for(var i=0,shape;shape=B.shapes.cemicircles[i];i++){var b=(shape.angleMin+shape.angleMax)/2;var c=DChart.Methods.GetCurrentAngle(x,y,H.centerX,H.centerY);var d=Math.pow(x-H.centerX,2)+Math.pow(y-H.centerY,2);if(d<=Math.pow(shape.outerRadius+O,2)&&d>=Math.pow(shape.innerRadius-O,2)&&DChart.Methods.JudgeBetweenAngle(shape.angleMin,shape.angleMax,c)){a=shape;break}}return a};var h=function(x,y){var a=null;for(var i=0,rectangle;rectangle=B.shapes.outerLabels[i];i++){if(x>=rectangle.left&&x<=rectangle.left+rectangle.width&&y>=rectangle.top&&y<=rectangle.top+rectangle.height){a=rectangle.data.index;break}}return a};B.canvas.onclick=function(e){var e=window.event||e;var a=B._getMouseLoction(e);var b=g(a.X,a.Y);if(b){b.click(e)}};B.canvas.onmousemove=function(e){var e=window.event||e;var a=B._getMouseLoction(e);var b=g(a.X,a.Y)||h(a.X,a.Y);if(B.tempData.currentMouseTarget!=b){var c=B.tempData.currentMouseTarget;if(c&&c.data){var d=typeof c.data.mouseleave=='function'?c.data.mouseleave:(C.mouseleave||null);if(d){d(c.data,e)}}B.tempData.currentMouseTarget=b;for(var i=0,c;c=B.shapes.cemicircles[i];i++){if(c.isHovered){c.isHovered=false;c.redraw();bb(c);if(c.hideTip){c.hideTip()}}}if(b!=null){if(b.data){be(b);var f=typeof b.data.mouseover=='function'?b.data.mouseover:(C.mouseover||null);if(f){f(b.data,e)}}else{for(var i=0,c;c=B.shapes.cemicircles[i];i++){if(c.index%G==b){be(c)}}}}else{if(C.mouseoverChangeCursor){B.canvas.style.cursor='auto'}}}}};B._startDrawAndAnimation(bd,bf)},_spreadSkin:function(a,b){var c=DChart.Const.Skins;if(c[a]&&c[a].MultiRing){var d=c[a].MultiRing;b.separeateLine={};b.innerLabel={};b.outerLabel={};b.separeateLine.color=d.SepareateLineColor||null;b.innerLabel.color=d.InnerLabelColor||null;b.outerLabel.color=d.OuterLabelColor||null;b.outerLabel.bordercolor=d.OuterLabelBorderColor||null;b.outerLabel.backcolor=d.OuterLabelBackColor||null}},_getCheckOptions:function(){return{__top:[['radius','n'],['margin','n'],['colors','ca'],['animateRotate','b'],['animateScale','b'],['startAngle','n'],['lengths','na'],['labels','sa']],separeateLine:[['show','b'],['color','c'],['width','n']],innerLabel:[['show','b'],['content','f'],['color','c'],['fontsize','n'],['fontfamily','s']],outerLabel:[['show','b'],['content','f'],['withlegend','b'],['legendtype','s'],['length','n'],['backcolor','c'],['bordercolor','c'],['borderwidth','n'],['color','c'],['fontsize','n'],['fontfamily','s']]}}});