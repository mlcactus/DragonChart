if(!window.DChart){throw new Error('未能加载dragonchart.core.js，该js必须在其他DChart框架的js加载之前被引用。\n'+'Not loaded dragonchart.core.js which must be loaded before other DChart\'s js.');}else{DChart.Const.Skins.BlackAndWhite.Ring={SepareateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:'rgba(255,255,255,0.3)'}}DChart.Ring=DChart.getCore().__extends({GraphType:'Ring',SetDefaultOptions:function(){this._resetSharedOpions();this.innerOptions=DChart.Methods.Extend(this.originalDefaultOptions,{innerRadius:null,outerRadius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,clickout:true,separeateLine:{show:false,color:null,width:null},innerLabel:{show:true,content:function(a){return a.percent.toFixed(1)+'%'},distance:null,color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(a){return a.text+' '+a.percent.toFixed(1)+'%'},withlegend:true,legendtype:null,length:null,color:null,backcolor:'rgba(255,255,255,0.3)',bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null}});return this},Draw:function(v,w){var z=this;if(arguments.length===1){if(!DChart.Methods.IsArray(arguments[0])){w=arguments[0];v=undefined}}z.SetOptions(w);z._checkOptions();var A=z.innerOptions;if(!A.animateRotate&&!A.animateScale){A.animation=false}z.SetData(v);z._onStart();var B=DChart.Const.Language[z.Language];var C=z._getDrawableCoordinate();var D=DChart.Methods.IsNumber(A.margin)&&A.margin>0?A.margin:15;var E=Math.min((C.maxX-C.minX)/3,(C.maxY-C.minY)/2)-D*2;var F=A.outerRadius&&A.outerRadius<E?A.outerRadius:E;var G=A.innerRadius&&A.innerRadius>E*0.1&&A.innerRadius<E?A.innerRadius:E*0.7;if(F<=G){throw new Error(B.WrongSet+B.OuterRadiusShouldBigger);}var H=A.separeateLine.show?(A.separeateLine.width||0.5):0;z.coordinates.draw=C;z.coordinates.ring={outerRadius:F,innerRadius:G,centerX:C.centerX,centerY:C.centerY};var I=0;for(var i=0,item;item=z.innerData[i];i++){var J=item.value;if(typeof J!='number'||J<0){throw new Error(B.WrongData+'\''+J+'\''+B.DataMustGreaterThanZero);}else{I+=J}}var K=(A.colors&&A.colors.length>0?A.colors:null)||DChart.Const.Defaults.FillColors;z.tempData.legendColors=K;var L=z.ctx;var M=F/10;z.shapes.cemicircles=[];z.shapes.outerLabels=[];z.coordinates.ring.cemicircles=[];z.coordinates.ring.outerlabels=[];var N=3;var O=3;var P=true;var Q=function(f,g,h,j,k){this.index=f;this.angleMin=g;this.angleMax=h;this.data=j;this.isHovered=false;this.isClickout=k;this.color=function(){return this.data.color||K[this.index%K.length]};this.redraw=function(a,b){S(a,1,this.angleMin,this.angleMax,b||this.color())};this.contact=null;this.click=function(e,a){if(A.clickout){P=true;this.isClickout=!this.isClickout;z._createAssists();U();for(var i=0,shape;shape=z.shapes.cemicircles[i];i++){if(shape&&shape!=this){shape.redraw(shape.isClickout)}else{this.redraw(this.isClickout);var b=A.mouseoverTransparency;var c='rgba(255,255,255,'+(b>0&&b<1?b:0.2)+')';this.redraw(this.isClickout,c);U(this,c)}}T()}if(!A.clickout||this.isClickout){var d=typeof this.data.click=='function'?this.data.click:(A.click||null);if(d){d(this.data,e)}}};if(A.tip.show&&typeof A.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=(this.angleMin+this.angleMax)/2;var b=C.centerX+(F+G)/2*Math.cos(a);var c=C.centerY+(F+G)/2*Math.sin(a);this.tip=z._createTip(A.tip.content(this.data),b,c);var d=this;d.tip.onclick=function(e){d.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var R=function(j,k,l,m,n,o,p,q){this.content=j;this.length=k;this.width=l;this.height=m;this.floatright=n;this.floattop=o;this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2};this.data=p;this.contact=q;this.color=function(){return this.contact.color()};this.index=function(){return this.contact.index};this.resetposition=function(){var a=this.length;var b=C.centerX;var c=C.centerY;var d=(this.contact.angleMin+this.contact.angleMax)/2;var e=Math.cos(d);var f=Math.sin(d);if(this.contact.isClickout){b+=M*e;c+=M*f}var g=1.15;var h=e>0?1+e:0;var i=f>0?f:0;this.startX=b+F*e;this.startY=c+F*f;this.left=b+F*g*e+(this.floatright?0:-this.width);this.top=c+F*g*f+i*a-a-O}};var S=function(a,b,c,d,e,f,g){var h=(c+d)/2;var i=C.centerX;var j=C.centerY;var k=Math.cos(h);var l=Math.sin(h);if(a){i+=M*k;j+=M*l}L.save();L.beginPath();L.moveTo(i+F*b*Math.cos(c),j+F*b*Math.sin(c));L.arc(i,j,F*b,c,d);L.lineTo(i+G*b*Math.cos(d),j+G*b*Math.sin(d));L.arc(i,j,G*b,d,c,true);L.closePath();L.fillStyle=e;L.fill();if(A.separeateLine.show){L.lineWidth=H;L.strokeStyle=A.separeateLine.color||A.lineColor||'#ffffff';L.stroke();L.restore()}var m=A.outerLabel;if(f&&m.show&&typeof m.content=='function'){var n=m.length||F/12;L.save();var o=DChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,h);var p=DChart.Methods.JudgeBetweenAngle(-Math.PI,0,h);var q=m.content(f);L.textAlign=o?'left':'right';L.font=(m.fontsize||(n-1))+'px '+(m.fontfamily||A.fontFamily||DChart.Const.Defaults.FontFamily);var r=L.measureText(q).width;L.restore();var s=r+(m.withlegend?n+3*N:2*N);var t=n+O*2;var u=new R(q,n,s,t,o?1:0,p?1:0,f,g);z.shapes.outerLabels.push(u);g.contact=u}};var T=function(g){var h=A.innerLabel;if(!(h.show&&typeof h.content=='function')){return}var j=(h.distance||0.85);var k=function(a){var b=(a.angleMin+a.angleMax)/2;var c=a.data;var d=a.isClickout?(F*j+M):F*j;var e=C.centerX+d*Math.cos(b);var f=C.centerY+d*Math.sin(b);z.DrawFigures.createText(h.content(c),e,f,'center',c.fontweight,c.fontsize||h.fontsize||F/10,h.fontfamily,c.fontcolor||h.color||DChart.Const.Defaults.InnerLabelColor)};if(g){k(g)}else{for(var i=0,shape;shape=z.shapes.cemicircles[i];i++){k(shape)}}};var U=function(l,m){var n=A.outerLabel;if(!(n.show&&typeof n.content=='function')){return}if(P){for(var i=0,shape;shape=z.shapes.outerLabels[i];i++){shape.resetposition()}P=false}var o=function(){var c=function(a,b){return Math.max(a.left,b.left)<=Math.min(a.left+a.width,b.left+b.width)&&Math.max(a.top,b.top)<=Math.min(a.top+a.height,b.top+b.height)};var d=[];var e=[];var f=[];var g=[];for(var i=0,shape;shape=z.shapes.outerLabels[i];i++){while(C.minY>shape.top){shape.top+=O;shape.left+=shape.floatright?N:-N}while(C.maxY<shape.top+shape.height){shape.top-=O;shape.left+=shape.floatright?N:-N}if(shape.floatright&&shape.floattop){f.push(shape)}else if(shape.floatright&&!shape.floattop){g.push(shape)}else if(!shape.floatright&&shape.floattop){d.push(shape)}else{e.push(shape)}}var h=0;var j=[];var k=function(r){if(j.length>0){for(var i=0,compare;compare=j[i];i++){while(c(compare,r)&&h<1000){r.top+=r.floattop?O:-O;r.left+=r.floatright?N:-N;h++}}}j.push(r)};for(var i=d.length-1;i>=0;i--){k(d[i])}j=[];for(var i=0;i<e.length;i++){k(e[i])}j=[];for(var i=0;i<f.length;i++){k(f[i])}j=[];for(var i=g.length-1;i>=0;i--){k(g[i])}};var p=function(a,b){var c=a;if(!b){z.DrawFigures.createQuadraticCurve(c.startX,c.startY,c.startX*0.8+c.endX()*0.2,c.startY*0.2+c.endY()*0.8,c.endX(),c.endY(),1,n.bordercolor);if(n.backcolor){z.DrawFigures.createRectangleFill(c.left,c.top,c.width,c.height,n.backcolor)}var d=c.left+(c.floatright?N+(n.withlegend?c.length+N:0):c.width-N);var e=c.top+c.length+O/2;z.DrawFigures.createText(c.content,d,e,c.floatright?'left':'right',null,n.fontsize||(c.length-1),n.fontfamily,n.color);if(n.borderwidth&&n.borderwidth>0){z.DrawFigures.createRectangleBorder(c.left,c.top,c.width,c.height,n.borderwidth,n.bordercolor)}}if(n.withlegend){var f=n.legendtype||'s';var b=b||c.color();z.DrawFigures.createPointElement(f,c.left+N,c.top+O,c.length,b,f!='x',b,2,f=='x')}};if(l){p(l.contact,m)}else{o();z.coordinates.ring.outerlabels.length=0;for(var i=0,shape;shape=z.shapes.outerLabels[i];i++){p(shape);z.coordinates.ring.outerlabels[i]={index:shape.contact.index,left:shape.left,top:shape.top,width:shape.width,height:shape.height}}}};var V=function(a,b){var c=Math.PI*(A.startAngle==null?-0.5:A.startAngle);var d=A.animation&&A.animateScale?a:1;var e=A.animation&&A.animateRotate?a:1;for(var i=0,item;item=z.innerData[i];i++){var f=(item.value/I)*100;var g=e*(f/100*(Math.PI*2));var h=item.color||K[i%K.length];var j=c+g;if(b>=1){item.index=i;item.percent=f;var k=new Q(i,c,j,item,item.extended==true);z.shapes.cemicircles.push(k);S(item.extended,d,c,j,h,item,k);z.coordinates.ring.cemicircles.push({index:i,percent:f,angleMin:c,angleMax:j,color:h})}else{S(item.extended,d,c,j,h)}c+=g}if(b>=1){T();U()}};var W=function(){var m=function(x,y){var a=null;for(var i=0,shape;shape=z.shapes.cemicircles[i];i++){var b=(shape.angleMin+shape.angleMax)/2;var c=M*Math.cos(b);var d=M*Math.sin(b);var e=C.centerX+(shape.isClickout?c:0);var f=C.centerY+(shape.isClickout?d:0);var g=DChart.Methods.GetCurrentAngle(x,y,e,f);var h=Math.pow(x-e,2)+Math.pow(y-f,2);var j=h>=Math.pow(G,2)&&h<=Math.pow(F,2)&&DChart.Methods.JudgeBetweenAngle(shape.angleMin,shape.angleMax,g);var k=false;if(A.outerLabel&&A.outerLabel.show&&shape.contact){var l=shape.contact;if(x>=l.left&&x<=l.left+l.width&&y>=l.top&&y<=l.top+l.height){k=true}}if(j||k){a=shape;break}}return a};z.canvas.onclick=function(e){var e=window.event||e;var a=z._getMouseLoction(e);var b=m(a.X,a.Y);if(b){b.click(e)}};z.canvas.onmousemove=function(e){var e=window.event||e;var a=z._getMouseLoction(e);var b=m(a.X,a.Y);if(z.tempData.currentMouseShape!=b){var c=z.tempData.currentMouseShape;if(c){var d=typeof c.data.mouseleave=='function'?c.data.mouseleave:(A.mouseleave||null);if(d){d(c.data,e)}}z.tempData.currentMouseShape=b;for(var i=0,c;c=z.shapes.cemicircles[i];i++){if(c.isHovered){c.isHovered=false;U(c,c.color());if(c.hideTip){c.hideTip()}}c.redraw(c.isClickout)}T();if(b){b.isHovered=true;if(A.mouseoverChangeCursor){z.canvas.style.cursor='pointer'}var f=A.mouseoverTransparency;var g='rgba(255,255,255,'+(f>0&&f<1?f:0.2)+')';b.redraw(b.isClickout,g);U(b,g);if(b.showTip){b.showTip()}var h=typeof b.data.mouseover=='function'?b.data.mouseover:(A.mouseover||null);if(h){h(b.data,e)}}else{if(A.mouseoverChangeCursor){z.canvas.style.cursor='auto'}}}}};z._startDrawAndAnimation(V,W)},_spreadSkin:function(a,b){var c=DChart.Const.Skins;if(c[a]&&c[a].Ring){var d=c[a].Ring;b.separeateLine={};b.innerLabel={};b.outerLabel={};b.separeateLine.color=d.SepareateLineColor||null;b.innerLabel.color=d.InnerLabelColor||null;b.outerLabel.color=d.OuterLabelColor||null;b.outerLabel.bordercolor=d.OuterLabelBorderColor||null;b.outerLabel.backcolor=d.OuterLabelBackColor||null}},_getCheckOptions:function(){return{__top:[['innerRadius','n'],['outerRadius','n'],['margin','n'],['colors','ca'],['animateRotate','b'],['animateScale','b'],['startAngle','n'],['clickout','b']],separeateLine:[['show','b'],['color','c'],['width','n']],innerLabel:[['show','b'],['content','f'],['distance','n'],['color','c'],['fontsize','n'],['fontfamily','s']],outerLabel:[['show','b'],['content','f'],['withlegend','b'],['legendtype','s'],['length','n'],['backcolor','c'],['bordercolor','c'],['borderwidth','n'],['color','c'],['fontsize','n'],['fontfamily','s']]}}});