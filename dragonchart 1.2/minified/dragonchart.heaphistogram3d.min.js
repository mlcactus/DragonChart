if(!window.DChart){throw new Error('未能加载dragonchart.core.js，该js必须在其他DChart框架的js加载之前被引用。\n'+'Not loaded dragonchart.core.js which must be loaded before other DChart\'s js.');}else{DChart.Const.Skins.BlackAndWhite.HeapHistogram3D={CutLinecolor:null,InnerLabelColor:null}}DChart.HeapHistogram3D=DChart.getCore().__extends({GraphType:'HeapHistogram3D'});DChart.HeapHistogram3D._spreadSkin=function(a,b){a.histogram={};a.label={};a.histogram.cutlinecolor=b.CutLinecolor||null;a.label.color=b.InnerLabelColor||null};DChart.HeapHistogram3D._getDefaultOptions=function(b){var c=DChart.Methods.Extend(b,{animateY:true,animateX:true,histogram:{colors:null,length:null,cutlinecolor:null,cutlinewidth:null},label:{show:true,content:function(a){return this.valueType=='p'?a.percent.toFixed(1)+'%':a.value.toString()},color:null,fontweight:null,fontsize:null,fontfamily:null}});return c};DChart.HeapHistogram3D._getCheckOptions=function(){return{__top:[['animateY','b'],['animateX','b']],histogram:[['colors','ca'],['length','n'],['cutlinecolor','c'],['cutlinewidth','n']],label:[['show','b'],['content','f'],['color','c'],['fontweight','s'],['fontsize','n'],['fontfamily','s']]}};DChart.HeapHistogram3D._drawgraphic=function(v,w,z,A){if(A.valueType&&A.valueType!='n'&&A.valueType!='p'){throw new Error(v._messages.WrongParam+v._messages.ValueTypeMustBeNumberOrPercent);}if(!z[0].value.length||z[0].value.length<=1){throw new Error(v._messages.WrongData+v._messages.DataMustBeMultipleArray);}v._configs.recreateAssists=true;if(w==v.ID){v._configs.notAllowValueNegative=true}var B=v._formatAxisData(true);var C=v._calculateOutersValid();var D=v._computeAxis(C);var E=v._getDrawableCoordinate();var F=Math.floor(A.histogram.cutlinewidth||0);var G=A.histogram.cutlinecolor||'#ffffff';var H=B.vValueType=='p';var I=A.histogram.length;if(I&&I>0){var J=D.labelDistance*0.8;I=Math.min(I,J)}else{I=D.labelDistance*0.6}var K=(A.histogram.colors&&A.histogram.colors.length>0?A.histogram.colors:null)||DChart.Const.Defaults.FillColors;if(w==v.ID){v.coordinates.draw=E;v._configs.legendColors=K}var L=v._configs.specificConfig[w];v.shapes[w]={histograms:[]};if(!v.coordinates.histograms){v.coordinates.histograms={}}v.coordinates.histograms[w]=[];var M=function(a,b,c,d,e,f){var g=a.left-D.stagewidth*D.sinsightangle;var h=a.top+D.stagewidth*D.cossightangle;var i=b||a.color;if(d){v.DrawFigures.create3DHistogram(g,h,a.width,a.height,i,0,D.sightangle,D.stagewidth,null,c?b:a.topcolor||DChart.Methods.getDarkenColor(i,0.7),c?b:a.rightcolor||DChart.Methods.getDarkenColor(i,0.8))}if(f&&A.label.show){var j=A.label;var k=typeof j.content=='function'?j.content.call(A,a.data):'';if(k){var l=g+a.width/2;var m=j.fontsize||DChart.Methods.CapValue(a.width/2,18,11);var n=h+a.height/2+m/3;v.DrawFigures.createText(k,l,n,'center',a.data.fontweight||j.fontweight,a.data.fontsize||m,j.fontfamily,a.data.fontcolor||j.color)}}if(e&&a.linetop){var o=a.linetop+D.stagewidth*D.cossightangle;if(F>1){v.DrawFigures.create3DHistogram(g,o,a.width,F,G,0,D.sightangle,D.stagewidth,null,G,G)}else{v.DrawFigures.createLine(g,o,g+a.width,o,F,G);v.DrawFigures.createLine(g+a.width,o,a.left+a.width,a.top,F,G)}}};var N=function(d,f,g,h,i,j,k,l,m,n,o){this.indexX=d;this.indexY=f;this.left=g;this.top=h;this.width=i;this.height=j;this.data=n;this.linetop=o;this.isHovered=false;this.color=k;this.topcolor=l;this.rightcolor=m;this.redraw=function(a){M(this,a,true,true)};this.click=function(e){var a=typeof this.data.click=='function'?this.data.click:(A.click||null);if(a){a(this.data,e)}};if(A.tip.show&&typeof A.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=this.left;var b=this.top+this.height/2;this.tip=v._createTip(A.tip.content.call(A,this.data),a,b);if(a+this.tip.clientWidth>D.maxX){v._changeTip(this.tip,a-this.tip.clientWidth-this.width)}var c=this;c.tip.onclick=function(e){c.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var O=function(c,d){var e=function(a){var b=(A.animateY?c:1)*(D.maxY-D.minY)*v._getFormatDiff(B.vValueType,B.vMinValue,a)/v._getFormatDiff(B.vValueType,B.vMinValue,B.vMaxValue);return b};var f=d>=1;var g=[];var h=(A.animateX?c:1)*I;for(var i=0;i<B.tuftCount;i++){var j=D.startPos+D.labelDistance*i-I/2;var l=0;var m=[];for(var k=0;k<B.demanCount;k++){var n=z[k];var o=n.color||K[k%K.length];var p=H?n.percent:n.value;var q=e(p[i]);l+=q;var r=D.maxY-l;if(r<D.minY+1){q-=D.minY+1-r;r=D.minY+1}if(k>0){q-=F/2}if(q+r>D.maxY){q=D.maxY-r}var s=null;if(F>0&&k<B.demanCount-1){s=r-F/2;if(s+F/2+1>D.maxY){s=D.maxY-F/2-1}}var t=null;if(f){t={click:n.click,mouseover:n.mouseover,mouseleave:n.mouseleave,text:n.text,indexX:i,indexY:k,fontsize:n.fontsize,fontcolor:n.fontcolor,fontweight:n.fontweight};if(H){t.percent=p[i];t.value=n.value[i]}else{t.value=p[i]}if(!v.coordinates.histograms[w][i]){v.coordinates.histograms[w][i]=[]}v.coordinates.histograms[w][i][k]={left:j,top:r,width:h,height:q,color:o}}var u=new N(i,k,j,r,h,q,o,n.topcolor,n.rightcolor,t,s);g.push(u)}}g.sort(function(a,b){if(a.indexX==b.indexX){return a.indexY-b.indexY}else{return a.indexX-b.indexX}});for(var i=0,u;u=g[i];i++){M(u,u.color,false,true,F>1)}if(F>0&&F<=1){for(var i=0,u;u=g[i];i++){M(u,u.color,false,false,true)}}if(f){for(var i=0,u;u=g[i];i++){M(u,u.color,false,false,false,true)}v.shapes[w].histograms=g}};var P=function(){var h=function(x,y){var a=null;var b=D.cossightangle*D.stagewidth;var c=D.sinsightangle*D.stagewidth;for(var i=0,shape;shape=v.shapes[w].histograms[i];i++){var d=shape.left-D.stagewidth*D.sinsightangle;var e=shape.top+D.stagewidth*D.cossightangle;if(d<=x&&d+shape.width>=x&&e<=y&&e+shape.height>=y){a=shape;break}}if(!a){for(var i=0,shape;shape=v.shapes[w].histograms[i];i++){if(shape.left+shape.width-c<=x&&shape.left+shape.width>=x){var f=shape.top+b*(shape.left+shape.width-x)/c;if(f<=y&&f+shape.height>=y){a=shape;break}}}}if(!a){for(var i=0,shape;shape=v.shapes[w].histograms[i];i++){if(shape.top<=y&&shape.top+b>=y){var g=shape.left-c*(y-shape.top)/b;if(g<=x&&g+shape.width>=x){a=shape;break}}}}return a};var j=function(e){var e=window.event||e;var a=v._getMouseLoction(e);var b=h(a.X,a.Y);if(b){b.click(e)}};var k=function(e){var e=window.event||e;var a=v._getMouseLoction(e);var b=h(a.X,a.Y);if(b){v._configs.cursorPointer=true}if(L.currentMouseShape!=b){var c=L.currentMouseShape;if(c){c.isHovered=false;if(c.hideTip){c.hideTip()}var d=typeof c.data.mouseleave=='function'?c.data.mouseleave:(A.mouseleave||null);if(d){d(c.data,e)}}if(L.currentMouseShape){v.redrawAll()}L.currentMouseShape=b;if(b){b.isHovered=true;var f=A.mouseoverTransparency;b.redraw('rgba(255,255,255,'+(f>0&&f<1?f:0.2)+')');if(b.showTip){b.showTip()}var g=typeof b.data.mouseover=='function'?b.data.mouseover:(A.mouseover||null);if(g){g(b.data,e)}}}};v._addEventListener('click',j);v._addEventListener('mousemove',k)};var Q=function(){for(var i=0,shape;shape=v.shapes[w].histograms[i];i++){M(shape,shape.color,false,true,F>1)}if(F>0&&F<=1){for(var i=0,shape;shape=v.shapes[w].histograms[i];i++){M(shape,shape.color,false,false,true)}}for(var i=0,shape;shape=v.shapes[w].histograms[i];i++){M(shape,shape.color,false,false,false,true)}};return{drawSegments:O,mouseEvents:P,redraw:Q}};