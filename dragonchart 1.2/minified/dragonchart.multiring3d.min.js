if(!window.DChart){throw new Error('未能加载dragonchart.core.js，该js必须在其他DChart框架的js加载之前被引用。\n'+'Not loaded dragonchart.core.js which must be loaded before other DChart\'s js.');}else{DChart.Const.Skins.BlackAndWhite.MultiRing3D={SeparateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:'rgba(255,255,255,0.3)'}}DChart.MultiRing3D=DChart.getCore().__extends({GraphType:'MultiRing3D'});DChart.MultiRing3D._spreadSkin=function(a,b){a.separateLine={};a.innerLabel={};a.outerLabel={};a.separateLine.color=b.SeparateLineColor||null;a.innerLabel.color=b.InnerLabelColor||null;a.outerLabel.color=b.OuterLabelColor||null;a.outerLabel.bordercolor=b.OuterLabelBorderColor||null;a.outerLabel.backcolor=b.OuterLabelBackColor||null};DChart.MultiRing3D._getDefaultOptions=function(b){var c=DChart.Methods.Extend(b,{offX:0,offY:0,radius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,lengths:null,labels:null,reflection3d:{reflectoffX:null,reflectoffY:null,zoomX:null,zoomY:null},separateLine:{color:null,width:null},innerLabel:{show:true,content:function(a){return a.percent.toFixed(1)+'%'},color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(a){return a.text},withlegend:true,legendtype:null,length:null,color:null,backcolor:'rgba(255,255,255,0.3)',bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null},tip:{content:function(a){return'<div>'+(a.label?a.label+'<br/>':'&nbsp;')+a.text+'<br/>value：'+a.value.toString()+'<br/>percent：'+a.percent.toFixed(1)+'%</div>'}}});return c};DChart.MultiRing3D._getCheckOptions=function(){return{__top:[['offX','n'],['offX','n'],['radius','n'],['margin','n'],['colors','ca'],['animateRotate','b'],['animateScale','b'],['startAngle','n'],['lengths','na'],['labels','sa']],reflection3d:[['reflectoffX','n'],['reflectoffY','n'],['zoomX','n'],['zoomY','n']],separateLine:[['color','c'],['width','n']],innerLabel:[['show','b'],['content','f'],['color','c'],['fontsize','n'],['fontfamily','s']],outerLabel:[['show','b'],['content','f'],['withlegend','b'],['legendtype','s'],['length','n'],['backcolor','c'],['bordercolor','c'],['borderwidth','n'],['color','c'],['fontsize','n'],['fontfamily','s']]}};DChart.MultiRing3D._drawgraphic=function(D,E,F,G){var H=D._computeSegmentTotal(F).segmentTotals;var I=3;var J=3;var K=G.reflection3d.zoomX||1.2;var L=G.reflection3d.zoomY||0.9;var M=D._computeRadiusForPies(G,K,L);var N=F[0].value.length;var O=F.length;if(!N||N<1){throw new Error(D._messages.WrongData+D._messages.DataMustBeMultipleArray);}var P=!G.radius||!DChart.Methods.IsNumber(G.radius)?M.maxRadius:G.radius;var Q=(G.colors&&G.colors.length>0?G.colors:null)||DChart.Const.Defaults.FillColors;var R=G.labels&&G.labels.length>0?G.labels:[''];var S=G.lengths&&G.lengths.length>0?G.lengths:null;var T=E==D.ID;if(T){D.coordinates.draw=M.coordinate;D._configs.legendColors=Q}if(!D.coordinates.multiRing){D.coordinates.multiRing={}}D.coordinates.multiRing[E]={radius:P,centerX:M.centerX,centerY:M.centerY,cemicircles:[],outerlabels:[]};if(S){var U=0;for(var k=0;k<N;k++){var V=S[k%S.length];U+=V}if(U>P){throw new Error(D._messages.WrongSet+D._messages.SumOfLengthsMustBeLessThanRadius);}}D.shapes[E]={cemicircles:[],outerLabels:[]};var W=D.shapes[E];var X=G.reflection3d.reflectoffX||0;var Y=G.reflection3d.reflectoffY||P/6;var Z=true;var ba=G.separateLine.width||1;var bb=G.separateLine.color||'#ffffff';var bc=Math.PI*(G.startAngle==null?-0.5:G.startAngle);var bd=D._configs.specificConfig[E];var be=function(f,g,h,i){var j=(h+i)/2;var k=M.centerX;var l=M.centerY;var m=Math.cos(j);var n=Math.sin(j);var o=k+X;var p=l+Y;var q=function(a,b,c){var d=a==0?k:(a==1?l:(a==2?o:p));var e=a==0||a==2?Math.cos:Math.sin;return d+e(b?i:h)*(c?g:f)};return{angleMin:h,angleMax:i,midAngle:j,centerX:k,centerY:l,darkCenterX:o,darkCenterY:p,innerRadius:f,outerRadius:g,iStartX:q(0,0,0),iStartY:q(1,0,0),iEndX:q(0,1,0),iEndY:q(1,1,0),oStartX:q(0,0,1),oStartY:q(1,0,1),oEndX:q(0,1,1),oEndY:q(1,1,1),d_iStartX:q(2,0,0),d_iStartY:q(3,0,0),d_iEndX:q(2,1,0),d_iEndY:q(3,1,0),d_oStartX:q(2,0,1),d_oStartY:q(3,0,1),d_oEndX:q(2,1,1),d_oEndY:q(3,1,1)}};var bf=function(f,g,h,j,k,l,m,n,o,p,q,r,s){this.indexX=f;this.indexY=g;this.color=h;this.darksidecolor=j;this.innerRadius=k;this.outerRadius=l;this.percent=m;this.angleMin=n;this.angleMax=o;this.midAngle=p;this.isLeft=q;this.isBottom=r;this.isHovered=false;this.data=s;this.redraw=function(a){var b=a;for(var i=0;i<4;i++){bh(this.indexX,i,a||this.color,this.innerRadius,this.outerRadius,this.angleMin,this.angleMax,b?a:this.darksidecolor,b)}};this.contact=null;this.computeinfo=function(a){if(!this._computeinfo||a){this._computeinfo=be(this.innerRadius,this.outerRadius,this.angleMin,this.angleMax)}return this._computeinfo};this.click=function(e){var a=typeof this.data.click=='function'?this.data.click:(G.click||null);if(a){a(this.data,e)}};if(G.tip.show&&typeof G.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=(this.angleMin+this.angleMax)/2;var b=M.centerX+(this.outerRadius+this.innerRadius)/2*Math.cos(a);var c=M.centerY+(this.outerRadius+this.innerRadius)/2*Math.sin(a);this.tip=D._createTip(G.tip.content(this.data),b*K,c*L);var d=this;d.tip.onclick=function(e){d.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var bg=function(h,i,j,k,l,m,n,o){this.content=h;this.length=i;this.width=j;this.height=k;this.floatright=l;this.floattop=m;this.data=n;this.contact=o;this.color=this.contact.color;this.index=this.contact.indexY;this.resetposition=function(){var a=this.length;var b=1.15;var c=this.contact.computeinfo();var d=Math.cos(c.midAngle);var e=Math.sin(c.midAngle);var f=d>0?1+d:0;var g=e>0?e:0;this.startX=(m?c.centerX:(c.centerX+c.darkCenterX)/2)+P*d;this.startY=(m?c.centerY:(c.centerY+c.darkCenterY)/2)+P*e;this.left=(m?c.centerX:c.darkCenterX)+P*b*d+(this.floatright?0:-this.width);this.top=(m?c.centerY:c.darkCenterY)+P*b*e+g*a-a-J};this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2}};var bh=function(a,b,c,d,e,f,g,h,i,j,k,l){var m=be(d,e,f,g);var n=i?0:ba;h=h||DChart.Methods.getDarkenColor(c);D.ctx.save();D.ctx.transform(K,0,0,L,0,0);switch(b){case 0:D.DrawFigures.createRingReflection(m,h,n,bb,false,a!=0);break;case 1:D.DrawFigures.createCloseFigure([[m.iStartX,m.iStartY],[m.d_iStartX,m.d_iStartY],[m.d_oStartX,m.d_oStartY],[m.oStartX,m.oStartY]],h);break;case 2:D.DrawFigures.createCloseFigure([[m.iEndX,m.iEndY],[m.d_iEndX,m.d_iEndY],[m.d_oEndX,m.d_oEndY],[m.oEndX,m.oEndY]],h);break;default:D.DrawFigures.createRing(m.centerX,m.centerY,m.innerRadius,m.outerRadius,c,f,g,n||.05,bb);break}D.ctx.restore();var o=G.outerLabel;if(j){var p=o.length||P/12;var q=DChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,m.midAngle);var r=DChart.Methods.JudgeBetweenAngle(-Math.PI,0,m.midAngle);var s=o.content(k);var t=D.DrawFigures.measureText(s,null,o.fontsize||(p-1),o.fontfamily);var u=t+(o.withlegend?p+3*I:2*I);var v=p+J*2;var w=new bg(s,p,u,v,q?1:0,r?1:0,k,l);W.outerLabels.push(w);l.contact=w}};var bi=function(g){var h=G.innerLabel;if(!(h.show&&typeof h.content=='function')){return}var j=function(a){var b=(a.angleMin+a.angleMax)/2;var c=a.data;var d=(a.innerRadius+a.outerRadius)/2;var e=M.centerX+d*Math.cos(b);var f=M.centerY+d*Math.sin(b);D.ctx.save();D.ctx.transform(K,0,0,L,0,0);D.DrawFigures.createText(h.content(c),e,f,'center',c.fontweight,c.fontsize||h.fontsize||DChart.Methods.CapValue((a.outerRadius-a.innerRadius)/3,15,11),h.fontfamily,c.fontcolor||h.color||DChart.Const.Defaults.InnerLabelColor);D.ctx.restore()};if(g){j(g)}else{for(var i=0,shape;shape=W.cemicircles[i];i++){j(shape)}}};var bj=function(l,m){var n=G.outerLabel;if(!(n.show&&typeof n.content=='function')){return}var o=(T?M.coordinate.minY:5)/L;var p=(T?M.coordinate.maxY:D.canvas.height-5)/L;W.outerLabels.sort(function(a,b){return a.index-b.index});if(Z){for(var i=0,shape;shape=W.outerLabels[i];i++){shape.resetposition()}Z=false}var q=function(){var c=function(a,b){return Math.max(a.left,b.left)<=Math.min(a.left+a.width,b.left+b.width)&&Math.max(a.top,b.top)<=Math.min(a.top+a.height,b.top+b.height)};var d=[];var e=[];var f=[];var g=[];for(var i=0,shape;shape=W.outerLabels[i];i++){while(o>shape.top){shape.top+=J;shape.left+=shape.floatright?I:-I}while(p<shape.top+shape.height){shape.top-=J;shape.left+=shape.floatright?I:-I}if(shape.floatright&&shape.floattop){f.push(shape)}else if(shape.floatright&&!shape.floattop){g.push(shape)}else if(!shape.floatright&&shape.floattop){d.push(shape)}else{e.push(shape)}}var h=0;var j=[];var k=function(r){if(j.length>0){for(var i=0,compare;compare=j[i];i++){while(c(compare,r)&&h<1000){r.top+=r.floattop?J:-J;r.left+=r.floatright?I:-I;h++}}}j.push(r)};for(var i=d.length-1;i>=0;i--){k(d[i])}j=[];for(var i=0;i<e.length;i++){k(e[i])}j=[];for(var i=0;i<f.length;i++){k(f[i])}j=[];for(var i=g.length-1;i>=0;i--){k(g[i])}};var s=function(a,b){var c=a;D.ctx.save();D.ctx.transform(K,0,0,L,0,0);if(!b){D.DrawFigures.createQuadraticCurve(c.startX,c.startY,c.startX*0.8+c.endX()*0.2,c.startY*0.2+c.endY()*0.8,c.endX(),c.endY(),1,n.bordercolor);if(n.backcolor){D.DrawFigures.createRectangleFill(c.left,c.top,c.width,c.height,n.backcolor)}var d=c.left+(c.floatright?I+(n.withlegend?c.length+I:0):c.width-I);var e=c.top+c.length+J/2;D.DrawFigures.createText(c.content,d,e,c.floatright?'left':'right',null,n.fontsize||(c.length-1),n.fontfamily,n.color);if(n.borderwidth&&n.borderwidth>0){D.DrawFigures.createRectangleBorder(c.left,c.top,c.width,c.height,n.borderwidth,n.bordercolor)}}if(n.withlegend){var f=n.legendtype||'s';var b=b||c.color;D.DrawFigures.createPointElement(f,c.left+I,c.top+J,c.length,b,f!='x',b,2,f=='x')}D.ctx.restore()};if(l){s(l.contact,m)}else{q();D.coordinates.multiRing[E].outerlabels.length=0;for(var i=0,shape;shape=W.outerLabels[i];i++){s(shape);D.coordinates.multiRing[E].outerlabels[i]={index:shape.index,left:shape.left,top:shape.top,width:shape.width,height:shape.height}}}};var bk=function(c,d){var e=G.animation&&G.animateScale?c:1;var f=G.animation&&G.animateRotate?c:1;var g=P;var h=d>=1;var j=function(a,b){bh(a.indexX,b,a.color,a.innerRadius,a.outerRadius,a.angleMin,a.angleMax,a.darksidecolor,false,h&&a.indexX==0&&b==3,a.data,a)};var l=[];for(var k=0;k<N;k++){var m=S?S[k%S.length]:P/(N<=2?2*N:2*N-1);var n=R[k%R.length];var o=g;g-=m;var p=g;var q=bc;for(var i=0,item;item=F[i];i++){var r=item.value[k];var s=i+O*k;var t=(r/H[k])*100;var u=t/100*Math.PI*2*f;var v=item.color||Q[i%Q.length];var w=q;var x=q+u;var y=(w+x)/2;var z=DChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,y);var A=DChart.Methods.JudgeBetweenAngle(w,x,Math.PI/2);var B=null;if(h){B={index:s,color:v,darksidecolor:item.darksidecolor,percent:t,value:r,text:item.text,label:n,click:item.click,mouseover:item.mouseover,mouseleave:item.mouseleave,fontsize:item.fontsize,fontcolor:item.fontcolor,fontweight:item.fontweight};D.coordinates.multiRing[E].cemicircles.push({index:s,percent:t,angleMin:w,angleMax:x,innerRadius:p,outerRadius:o})}var C=new bf(k,i,v,item.darksidecolor,p,o,t,w,x,y,z,A,B);l.push(C);q+=u}}l.sort(function(a,b){if(a.indexX>0&&a.indexX<N-1){return-1}else if(b.indexX>0&&b.indexX<N-1){return 1}else{if(a.isBottom&&a.indexX==0){return 1}else if(b.isBottom&&b.indexX==0){return-1}if(a.isBottom&&a.indexX==N-1){return-1}else if(b.isBottom&&b.indexX==N-1){return 1}else{if(a.indexX==b.indexX){if(a.isLeft==b.isLeft){if(a.isLeft){return a.midAngle<b.midAngle?-1:1}else{return a.midAngle<b.midAngle?1:-1}}else{if(a.isLeft){return-1}else{return 1}}}else{if(a.indexX==0){return-1}}}}});for(var i=0,shapeitem;shapeitem=l[i];i++){j(shapeitem,0);j(shapeitem,1);j(shapeitem,2)}for(var i=0,shapeitem;shapeitem=l[i];i++){j(shapeitem,3)}if(h){W.cemicircles=l;bi();bj()}};var bl=function(){var c=function(a,b){bh(a.indexX,b,a.color,a.innerRadius,a.outerRadius,a.angleMin,a.angleMax,a.darksidecolor)};for(var i=0,shapeitem;shapeitem=W.cemicircles[i];i++){c(shapeitem,0);c(shapeitem,1);c(shapeitem,2)}for(var i=0,shapeitem;shapeitem=W.cemicircles[i];i++){c(shapeitem,3)}bi();bj()};var bm=function(){var g=function(a){a.isHovered=true;var b=G.mouseoverTransparency;a.redraw('rgba(255,255,255,'+(b>0&&b<1?b:0.2)+')');if(a.showTip){a.showTip()}};var h=function(x,y){var a=null;for(var i=0,e;e=W.cemicircles[i];i++){var b=e.computeinfo();var c=DChart.Methods.GetCurrentAngle(x,y,b.centerX,b.centerY);var d=Math.pow(x-b.centerX,2)+Math.pow(y-b.centerY,2);if(d>=Math.pow(b.innerRadius,2)&&d<=Math.pow(b.outerRadius,2)&&DChart.Methods.JudgeBetweenAngle(e.angleMin,e.angleMax,c)){a=e;break}}if(!a){for(var i=W.cemicircles.length-1;i>=0;i--){var e=W.cemicircles[i];var b=e.computeinfo();var d=Math.pow(x-b.darkCenterX,2)+Math.pow(y-b.darkCenterY,2);var f=DChart.Methods.GetCurrentAngle(x,y,b.darkCenterX,b.darkCenterY);if(d>=Math.pow(b.innerRadius,2)&&d<=Math.pow(b.outerRadius,2)&&DChart.Methods.JudgeBetweenAngle(e.angleMin,e.angleMax,f)){a=e;break}}}return a};var j=function(x,y){var a=null;for(var i=0,rectangle;rectangle=W.outerLabels[i];i++){if(x>=rectangle.left&&x<=rectangle.left+rectangle.width&&y>=rectangle.top&&y<=rectangle.top+rectangle.height){a=rectangle.index;break}}return a};var k=function(e){var e=window.event||e;var a=DChart.Methods.tranferLocation(D._getMouseLoction(e),K,L);var b=h(a.X,a.Y);if(b){b.click(e)}};var l=function(e){var e=window.event||e;var a=DChart.Methods.tranferLocation(D._getMouseLoction(e),K,L);var b=h(a.X,a.Y)||j(a.X,a.Y);if(b){D._configs.cursorPointer=true}if(bd.currentMouseTarget!=b){var c=bd.currentMouseTarget;if(c&&c.data){var d=typeof c.data.mouseleave=='function'?c.data.mouseleave:(G.mouseleave||null);if(d){d(c.data,e)}}if(bd.currentMouseTarget!=null){D.redrawAll()}bd.currentMouseTarget=b;for(var i=0,c;c=W.cemicircles[i];i++){if(c.isHovered){c.isHovered=false;if(c.hideTip){c.hideTip()}}}if(b!=null){if(b.data){g(b);var f=typeof b.data.mouseover=='function'?b.data.mouseover:(G.mouseover||null);if(f){f(b.data,e)}}else{for(var i=0,c;c=W.cemicircles[i];i++){if(c.indexY%O==b){g(c)}}}}}};D._addEventListener('click',k);D._addEventListener('mousemove',l)};return{drawSegments:bk,mouseEvents:bm,redraw:bl}};