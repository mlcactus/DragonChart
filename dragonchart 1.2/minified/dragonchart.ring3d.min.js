if(!window.DChart){throw new Error('未能加载dragonchart.core.js，该js必须在其他DChart框架的js加载之前被引用。\n'+'Not loaded dragonchart.core.js which must be loaded before other DChart\'s js.');}else{DChart.Const.Skins.BlackAndWhite.Ring3D={SeparateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:'rgba(255,255,255,0.3)'}}DChart.Ring3D=DChart.getCore().__extends({GraphType:'Ring3D'});DChart.Ring3D._spreadSkin=function(a,b){a.separateLine={};a.innerLabel={};a.outerLabel={};a.separateLine.color=b.SeparateLineColor||null;a.innerLabel.color=b.InnerLabelColor||null;a.outerLabel.color=b.OuterLabelColor||null;a.outerLabel.bordercolor=b.OuterLabelBorderColor||null;a.outerLabel.backcolor=b.OuterLabelBackColor||null};DChart.Ring3D._getDefaultOptions=function(b){var c=DChart.Methods.Extend(b,{offX:0,offY:0,innerRadius:null,outerRadius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,clickout:true,reflection3d:{reflectoffX:null,reflectoffY:null,zoomX:null,zoomY:null},separateLine:{show:false,color:null,width:null},innerLabel:{show:true,content:function(a){return a.percent.toFixed(1)+'%'},distance:null,color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(a){return a.text+' '+a.percent.toFixed(1)+'%'},withlegend:true,legendtype:null,length:null,color:null,backcolor:'rgba(255,255,255,0.3)',bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null}});return c};DChart.Ring3D._getCheckOptions=function(){return{__top:[['offX','n'],['offX','n'],['innerRadius','n'],['outerRadius','n'],['margin','n'],['colors','ca'],['animateRotate','b'],['animateScale','b'],['startAngle','n'],['clickout','b']],reflection3d:[['reflectoffX','n'],['reflectoffY','n'],['zoomX','n'],['zoomY','n']],separateLine:[['show','b'],['color','c'],['width','n']],innerLabel:[['show','b'],['content','f'],['distance','n'],['color','c'],['fontsize','n'],['fontfamily','s']],outerLabel:[['show','b'],['content','f'],['withlegend','b'],['legendtype','s'],['length','n'],['backcolor','c'],['bordercolor','c'],['borderwidth','n'],['color','c'],['fontsize','n'],['fontfamily','s']]}};DChart.Ring3D._drawgraphic=function(w,z,A,B){var C=w._computeSegmentTotal(A).segmentTotal;var D=3;var E=3;var F=B.reflection3d.zoomX||1.2;var G=B.reflection3d.zoomY||0.9;var H=w._computeRadiusForPies(B,F,G);var I=!B.outerRadius||!DChart.Methods.IsNumber(B.outerRadius)?H.maxRadius:B.outerRadius;var J=B.innerRadius&&B.innerRadius>I*0.1&&B.innerRadius<I?B.innerRadius:I*0.7;if(I<=J){throw new Error(w._messages.WrongSet+w._messages.OuterRadiusShouldBigger);}var K=I/10;var L=z==w.ID;var M=(B.colors&&B.colors.length>0?B.colors:null)||DChart.Const.Defaults.FillColors;if(L){w.coordinates.draw=H.coordinate;w._configs.legendColors=M}w.shapes[z]={cemicircles:[],outerLabels:[]};var N=w.shapes[z];if(!w.coordinates.ring){w.coordinates.ring={}}w.coordinates.ring[z]={outerRadius:I,innerRadius:J,centerX:H.centerX,centerY:H.centerY,cemicircles:[],outerlabels:[]};var O=B.reflection3d.reflectoffX||0;var P=B.reflection3d.reflectoffY||I/6;var Q=true;var R=w._configs.specificConfig[z];var S=B.separateLine.show?(B.separateLine.width||1):0;var T=B.separateLine.color||'#ffffff';var U=Math.PI*(B.startAngle==null?-0.5:B.startAngle);var V=function(f,g,h,i){var j=(h+i)/2;var k=H.centerX;var l=H.centerY;var m=Math.cos(j);var n=Math.sin(j);if(f){k+=K*m;l+=K*n}var o=J*g;var p=I*g;var q=k+O;var r=l+P;var s=function(a,b,c){var d=a==0?k:(a==1?l:(a==2?q:r));var e=a==0||a==2?Math.cos:Math.sin;return d+e(b?i:h)*(c?p:o)};return{angleMin:h,angleMax:i,midAngle:j,centerX:k,centerY:l,darkCenterX:q,darkCenterY:r,innerRadius:o,outerRadius:p,iStartX:s(0,0,0),iStartY:s(1,0,0),iEndX:s(0,1,0),iEndY:s(1,1,0),oStartX:s(0,0,1),oStartY:s(1,0,1),oEndX:s(0,1,1),oEndY:s(1,1,1),d_iStartX:s(2,0,0),d_iStartY:s(3,0,0),d_iEndX:s(2,1,0),d_iEndY:s(3,1,0),d_oStartX:s(2,0,1),d_oStartY:s(3,0,1),d_oEndX:s(2,1,1),d_oEndY:s(3,1,1)}};var W=function(h,i,j,k,l,m,n,o){this.content=h;this.length=i;this.width=j;this.height=k;this.floatright=l;this.floattop=m;this.data=n;this.contact=o;this.color=this.contact.color;this.index=this.contact.index;this.resetposition=function(){var a=this.length;var b=1.15;var c=this.contact.computeinfo();var d=Math.cos(c.midAngle);var e=Math.sin(c.midAngle);var f=d>0?1+d:0;var g=e>0?e:0;this.startX=(m?c.centerX:(c.centerX+c.darkCenterX)/2)+I*d;this.startY=(m?c.centerY:(c.centerY+c.darkCenterY)/2)+I*e;this.left=(m?c.centerX:c.darkCenterX)+I*b*d+(this.floatright?0:-this.width);this.top=(m?c.centerY:c.darkCenterY)+I*b*e+g*a-a-E};this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2}};var X=function(f,g,h,j,k,l,m,n,o,p){this.index=f;this.color=g;this.percent=h;this.angleMin=j;this.angleMax=k;this.midAngle=l;this.isLeft=m;this.isBottom=n;this.isHovered=false;this.isClickout=p;this.data=o;this.redraw=function(a,b){var c=b;for(var i=0;i<4;i++){Y(i,a,1,this.angleMin,this.angleMax,b||this.color,c,c?b:this.data.darksidecolor)}};this.contact=null;this.computeinfo=function(a){if(!this._computeinfo||a){this._computeinfo=V(this.isClickout,1,this.angleMin,this.angleMax)}return this._computeinfo};this.click=function(e,a){if(B.clickout){Q=true;this.isClickout=!this.isClickout;this.computeinfo(true);w.redrawAll();var b=B.mouseoverTransparency;var c='rgba(255,255,255,'+(b>0&&b<1?b:0.2)+')';this.redraw(this.isClickout,c);ba(this,c)}if(!B.clickout||this.isClickout){var d=typeof this.data.click=='function'?this.data.click:(B.click||null);if(d){d(this.data,e)}}};if(B.tip.show&&typeof B.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=(this.angleMin+this.angleMax)/2;var b=H.centerX+(I+J)/2*Math.cos(a);var c=H.centerY+(I+J)/2*Math.sin(a);this.tip=w._createTip(B.tip.content(this.data),b*F,c*G);var d=this;d.tip.onclick=function(e){d.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var Y=function(a,b,c,d,e,f,g,h,i,j){var k=V(b,c,d,e);h=h||DChart.Methods.getDarkenColor(f);var l=g?0:S;w.ctx.save();w.ctx.transform(F,0,0,G,0,0);switch(a){case 0:w.DrawFigures.createRingReflection(k,h,l,T);break;case 1:w.DrawFigures.createCloseFigure([[k.iStartX,k.iStartY],[k.d_iStartX,k.d_iStartY],[k.d_oStartX,k.d_oStartY],[k.oStartX,k.oStartY]],h);break;case 2:w.DrawFigures.createCloseFigure([[k.iEndX,k.iEndY],[k.d_iEndX,k.d_iEndY],[k.d_oEndX,k.d_oEndY],[k.oEndX,k.oEndY]],h);break;default:w.DrawFigures.createRing(k.centerX,k.centerY,k.innerRadius,k.outerRadius,f,d,e,l,T);break}w.ctx.restore();var m=B.outerLabel;if(i&&m.show&&typeof m.content=='function'){var n=m.length||I/12;var o=DChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,k.midAngle);var p=DChart.Methods.JudgeBetweenAngle(-Math.PI,0,k.midAngle);var q=m.content(i);var r=w.DrawFigures.measureText(q,null,m.fontsize||(n-1),m.fontfamily);var s=r+(m.withlegend?n+3*D:2*D);var t=n+E*2;var u=new W(q,n,s,t,o?1:0,p?1:0,i,j);N.outerLabels.push(u);j.contact=u}};var Z=function(g){var h=B.innerLabel;if(!(h.show&&typeof h.content=='function')){return}var j=(h.distance||0.5);var k=function(a){var b=(a.angleMin+a.angleMax)/2;var c=a.data;var d=J+(I-J)*j+(a.isClickout?K:0);var e=H.centerX+d*Math.cos(b);var f=H.centerY+d*Math.sin(b);w.ctx.save();w.ctx.transform(F,0,0,G,0,0);w.DrawFigures.createText(h.content(c),e,f,'center',c.fontweight,c.fontsize||h.fontsize||I/10,h.fontfamily,c.fontcolor||h.color||DChart.Const.Defaults.InnerLabelColor);w.ctx.restore()};if(g){k(g)}else{for(var i=0,shape;shape=N.cemicircles[i];i++){k(shape)}}};var ba=function(l,m){var n=B.outerLabel;if(!(n.show&&typeof n.content=='function')){return}var o=(L?H.coordinate.minY:5)/G;var p=(L?H.coordinate.maxY:w.canvas.height-5)/G;N.outerLabels.sort(function(a,b){return a.index-b.index});if(Q){for(var i=0,shape;shape=N.outerLabels[i];i++){shape.resetposition()}Q=false}var q=function(){var c=function(a,b){return Math.max(a.left,b.left)<=Math.min(a.left+a.width,b.left+b.width)&&Math.max(a.top,b.top)<=Math.min(a.top+a.height,b.top+b.height)};var d=[];var e=[];var f=[];var g=[];for(var i=0,shape;shape=N.outerLabels[i];i++){while(o>shape.top){shape.top+=E;shape.left+=shape.floatright?D:-D}while(p<shape.top+shape.height){shape.top-=E;shape.left+=shape.floatright?D:-D}if(shape.floatright&&shape.floattop){f.push(shape)}else if(shape.floatright&&!shape.floattop){g.push(shape)}else if(!shape.floatright&&shape.floattop){d.push(shape)}else{e.push(shape)}}var h=0;var j=[];var k=function(r){if(j.length>0){for(var i=0,compare;compare=j[i];i++){while(c(compare,r)&&h<1000){r.top+=r.floattop?E:-E;r.left+=r.floatright?D:-D;h++}}}j.push(r)};for(var i=d.length-1;i>=0;i--){k(d[i])}j=[];for(var i=0;i<e.length;i++){k(e[i])}j=[];for(var i=0;i<f.length;i++){k(f[i])}j=[];for(var i=g.length-1;i>=0;i--){k(g[i])}};var s=function(a,b){var c=a;w.ctx.save();w.ctx.transform(F,0,0,G,0,0);if(!b){w.DrawFigures.createQuadraticCurve(c.startX,c.startY,c.startX*0.8+c.endX()*0.2,c.startY*0.2+c.endY()*0.8,c.endX(),c.endY(),1,n.bordercolor);if(n.backcolor){w.DrawFigures.createRectangleFill(c.left,c.top,c.width,c.height,n.backcolor)}var d=c.left+(c.floatright?D+(n.withlegend?c.length+D:0):c.width-D);var e=c.top+c.length+E/2;w.DrawFigures.createText(c.content,d,e,c.floatright?'left':'right',null,n.fontsize||(c.length-1),n.fontfamily,n.color);if(n.borderwidth&&n.borderwidth>0){w.DrawFigures.createRectangleBorder(c.left,c.top,c.width,c.height,n.borderwidth,n.bordercolor)}}if(n.withlegend){var f=n.legendtype||'s';var b=b||c.color;w.DrawFigures.createPointElement(f,c.left+D,c.top+E,c.length,b,f!='x',b,2,f=='x')}w.ctx.restore()};if(l){s(l.contact,m)}else{q();w.coordinates.ring[z].outerlabels.length=0;for(var i=0,shape;shape=N.outerLabels[i];i++){s(shape);w.coordinates.ring[z].outerlabels[i]={index:shape.contact.index,left:shape.left,top:shape.top,width:shape.width,height:shape.height}}}};var bb=function(e,f){var g=B.animation&&B.animateScale?e:1;var h=B.animation&&B.animateRotate?e:1;var j=f>=1;var k=[];var l=U;for(var i=0,item;item=A[i];i++){var m=(item.value/C)*100;var n=m/100*Math.PI*2*h;var o=item.color||M[i%M.length];var p=l;var q=l+n;var r=(p+q)/2;var s=DChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,r);var t=DChart.Methods.JudgeBetweenAngle(p,q,Math.PI/2);if(j){item.percent=m;w.coordinates.ring[z].cemicircles.push({index:i,percent:m,angleMin:p,angleMax:q,color:o})}var u=new X(i,o,m,p,q,r,s,t,item,item.extended);k.push(u);l+=n}k.sort(function(a,b){if(a.isBottom){return 1}else if(b.isBottom){return-1}else{if(a.isLeft==b.isLeft){if(a.isLeft){return a.midAngle<b.midAngle?-1:1}else{return a.midAngle<b.midAngle?1:-1}}else{if(a.isLeft){return-1}else{return 1}}}});var v=function(a,b,c,d){Y(b,a.data.extended,g,a.angleMin,a.angleMax,a.color,false,a.data.darksidecolor,j&&b==3?a.data:null,j&&b==3?a:null)};for(var i=0,shapeitem;shapeitem=k[i];i++){v(shapeitem,0);v(shapeitem,1);v(shapeitem,2);v(shapeitem,3)}if(j){N.cemicircles=k;Z();ba()}};var bc=function(){var l=function(x,y){var a=null;for(var i=0,h;h=N.cemicircles[i];i++){var b=h.computeinfo();var c=DChart.Methods.GetCurrentAngle(x,y,b.centerX,b.centerY);var d=Math.pow(x-b.centerX,2)+Math.pow(y-b.centerY,2);var e=d>=Math.pow(J,2)&&d<=Math.pow(I,2)&&DChart.Methods.JudgeBetweenAngle(h.angleMin,h.angleMax,c);var f=false;if(B.outerLabel&&B.outerLabel.show&&h.contact){var g=h.contact;if(x>=g.left&&x<=g.left+g.width&&y>=g.top&&y<=g.top+g.height){f=true}}if(e||f){a=h;break}}if(!a){for(var i=N.cemicircles.length-1;i>=0;i--){var h=N.cemicircles[i];var b=h.computeinfo();var d=Math.pow(x-b.darkCenterX,2)+Math.pow(y-b.darkCenterY,2);var j=DChart.Methods.GetCurrentAngle(x,y,b.darkCenterX,b.darkCenterY);var k=d>=Math.pow(J,2)&&d<=Math.pow(I,2)&&DChart.Methods.JudgeBetweenAngle(h.angleMin,h.angleMax,j);if(k){a=h;break}}}return a};var m=function(e){var e=window.event||e;var a=DChart.Methods.tranferLocation(w._getMouseLoction(e),F,G);var b=l(a.X,a.Y);if(b){b.click(e)}};var n=function(e){var e=window.event||e;var a=DChart.Methods.tranferLocation(w._getMouseLoction(e),F,G);var b=l(a.X,a.Y);if(b){w._configs.cursorPointer=true}if(R.currentMouseShape!=b){var c=R.currentMouseShape;if(c){var d=typeof c.data.mouseleave=='function'?c.data.mouseleave:(B.mouseleave||null);if(d){d(c.data,e)}}if(R.currentMouseShape){w.redrawAll()}R.currentMouseShape=b;for(var i=0,c;c=N.cemicircles[i];i++){if(c.isHovered){c.isHovered=false;if(c.hideTip){c.hideTip()}}}if(b){b.isHovered=true;var f=B.mouseoverTransparency;var g='rgba(255,255,255,'+(f>0&&f<1?f:0.2)+')';b.redraw(b.isClickout,g);ba(b,g);if(b.showTip){b.showTip()}var h=typeof b.data.mouseover=='function'?b.data.mouseover:(B.mouseover||null);if(h){h(b.data,e)}}}};w._addEventListener('click',m);w._addEventListener('mousemove',n)};var bd=function(){for(var i=0,shape;shape=N.cemicircles[i];i++){shape.redraw(shape.isClickout)}Z();ba()};return{drawSegments:bb,mouseEvents:bc,redraw:bd}};