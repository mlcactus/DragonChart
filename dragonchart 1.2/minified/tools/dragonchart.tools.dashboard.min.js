dcharttools.dashboard=function(C){var D=this;D.parentDivID=C;D._initial=function(){var a=document.getElementById(D.parentDivID);if(a!=null&&a.nodeName.toLowerCase()=='div'){D.parentDiv=a}else{throw new Error("The parent element doesn't exist or isn't a div!");}D.parentDiv.innerHTML="";var b=document.createElement('canvas');D.ID='DChart_'+Math.random().toString().substring(5);b.setAttribute('id',D.ID);b.width=D.parentDiv.clientWidth;b.height=D.parentDiv.clientHeight;if(!!window.ActiveXObject&&!document.createElement('canvas').getContext){if(window.G_vmlCanvasManager){b=window.G_vmlCanvasManager.initElement(b)}else{throw new Error("please include excanvas.js!");}}D.parentDiv.appendChild(b);D.canvas=b;D.ctx=b.getContext('2d');D._configs={};D._configs._currentval=0;D._configs._nextval=0;D._configs._unfinished=[];D._configs._isRunning=false;D._configs._isWarning=false;D._configs._warningCount=0;D._configs._warningHandler=null;D._configs._computed=null;D.options=D._getDefaultOptions()};D._getDefaultOptions=function(){var b={animation:true,animationTime:1,animationSteps:24,centerX:null,centerY:null,radius:null,canvas:{backcolor:null,borderwidth:1,bordercolor:null},background:{backcolor:null,borderwidth:1,bordercolor:null,shadowcolor:'#000000',shadowblur:0},calibration:{margin:null,minvalue:0,maxvalue:200,scalecount:10,startangle:-0.8,endangle:0.8,length:null,linecolor:'#999999',thinwidth:1,thickwidth:2,thickerwidth:4,grades:[{color:'rgba(16,173,28,0.5)',minvalue:0,maxvalue:100},{color:'rgba(255,153,51,0.5)',minvalue:100,maxvalue:150},{color:'rgba(239,11,11,0.5)',minvalue:150,maxvalue:null}]},labels:{margin:null,content:function(a){return a.toString()},interval:10,fontcolor:null,fontsize:null,fontfamily:null,fontweight:null},pointer:{nodecolor:null,nodelength:null,pincolor:null,tailwidth:null,pinlength:null},unit:{content:null,distance:null,fontcolor:null,fontsize:null,fontfamily:null,fontweight:null,backcolor:null,borderwidth:0,bordercolor:null},currentValue:{show:true,content:function(a){return a.toFixed(1)},distance:null,fontcolor:null,fontsize:null,fontfamily:null,fontweight:null,backcolor:null,borderwidth:0,bordercolor:null},warning:{thresholdmin:null,thresholdmax:null,warningframes:5,contentmin:'Exceeded the minimum warning value!!!',contentmax:'Exceeded the maximum warning value!!!',locatetop:true,distance:null,fontcolor:null,fontsize:null,fontfamily:null,fontweight:null}};return b};D._computeOptions=function(a){if(!a&&D._configs._computed){return D._configs._computed}var b=D.options;var c=b.centerX||D.canvas.width/2;var d=b.centerY||D.canvas.height/2;var e=b.radius||Math.min(D.canvas.width,D.canvas.height)*0.4;var f=b.calibration.margin||e/20;var g=b.calibration.length||e/10;var h=e-f-g;var i=e-f;var j={length:g,margin:f,innerRadius:h,outerRadius:i};var k=b.labels.margin||e/15;var l=b.labels.fontsize||e/10;var m=h-k;var n={margin:k,radius:m,fontsize:l};var o=b.pointer.nodelength||e/12;var p=b.pointer.tailwidth||e/25;var q=b.pointer.pinlength||e*0.9;if(q>=e+o){throw new Error("pinlength should be less than radius!");}var r={nodelength:o,tailwidth:p,pinlength:q};var s=b.unit.distance==null?0.2:b.unit.distance;var t=b.unit.fontsize||e/8;var u={distance:s,fontsize:t};var v=b.currentValue.distance==null?0.2:b.currentValue.distance;var w=b.currentValue.fontsize||e/8;var x={distance:v,fontsize:w};var y=b.warning.distance==null?1.1:b.warning.distance;var z=b.warning.fontsize||e/8;var A={distance:y,fontsize:z};D._configs._computed={centerX:c,centerY:d,radius:e,calibration:j,labels:n,pointer:r,unit:u,currentValue:x,warning:A};return D._configs._computed};D._drawCanvasBackround=function(){var a=D.options.canvas;if(a.backcolor){dcharttools.createRect(D.ctx,0,0,D.canvas.width,D.canvas.height,a.backcolor)}else{D.ctx.clearRect(0,0,D.canvas.width,D.canvas.height)}var b=a.borderwidth||0;if(b>0){dcharttools.createRect(D.ctx,0,0,D.canvas.width,D.canvas.height,null,b*2,a.bordercolor)}};D._drawBackground=function(){var a=D._computeOptions();var b=D.options.background;var c=null;if(b.shadowblur>0){c={color:b.shadowcolor||'#000000',blur:b.shadowblur}}dcharttools.createArc(D.ctx,a.centerX,a.centerY,a.radius,0,null,b.backcolor||'#F2F2F2',null,null,c);dcharttools.createArc(D.ctx,a.centerX,a.centerY,a.radius,b.borderwidth,b.bordercolor)};D._drawCalibration=function(){var a=D._computeOptions();var b=D.options.calibration;var c=D.options.labels;var d=a.calibration.margin;var e=a.calibration.length;var f=a.calibration.innerRadius;var g=a.calibration.outerRadius;var h=a.labels.radius;var j=b.grades;for(var i=0;i<j.length;i++){var k=j[i].minvalue||b.minvalue;var l=j[i].maxvalue||b.maxvalue;var m=b.startangle-0.5+(b.endangle-b.startangle)*(k-b.minvalue)/(b.maxvalue-b.minvalue);var n=b.startangle-0.5+(b.endangle-b.startangle)*(l-b.minvalue)/(b.maxvalue-b.minvalue);dcharttools.createRing(D.ctx,a.centerX,a.centerY,f,g,j[i].color,m*Math.PI,n*Math.PI)}var o=b.scalecount*10;var p=(b.endangle-b.startangle)*Math.PI/o;var q=(b.maxvalue-b.minvalue)/o;for(var i=0;i<o+1;i++){var r=b.startangle*Math.PI+p*i;var s=Math.sin(r);var t=Math.cos(r);var u=a.centerX+f*s;var v=a.centerY-f*t;var w=a.centerX+g*s;var x=a.centerY-g*t;dcharttools.createLine(D.ctx,u,v,w,x,i%10==0?b.thickerwidth:(i%5==0?b.thickwidth:b.thinwidth),b.linecolor);if(i%c.interval==0){var y=b.minvalue+i*q;var z=c.content(y);var A=a.centerX+(h-a.labels.fontsize/2)*s;var B=a.centerY-(h-a.labels.fontsize/2)*t;dcharttools.createText(D.ctx,z,A,B,'center',c.fontweight,a.labels.fontsize,c.fontfamily,c.fontcolor,r)}}};D._drawPointer=function(a){var b=D._computeOptions();var c=D.options.pointer;var d=D.options.calibration;var e=d.startangle*Math.PI+(d.endangle-d.startangle)*Math.PI*(a-d.minvalue)/(d.maxvalue-d.minvalue);var f=Math.sin(e);var g=Math.cos(e);var h=b.centerX+(b.pointer.pinlength-b.pointer.nodelength)*f;var i=b.centerY-(b.pointer.pinlength-b.pointer.nodelength)*g;var j=b.centerX-b.pointer.nodelength*f-b.pointer.tailwidth/2*g;var k=b.centerY+b.pointer.nodelength*g-b.pointer.tailwidth/2*f;var l=b.centerX-b.pointer.nodelength*f+b.pointer.tailwidth/2*g;var m=b.centerY+b.pointer.nodelength*g+b.pointer.tailwidth/2*f;var n=[[h,i],[j,k],[l,m]];dcharttools.createArc(D.ctx,b.centerX,b.centerY,b.pointer.nodelength/2,0,null,c.nodecolor||'#000000');dcharttools.createCloseFigure(D.ctx,n,c.pincolor||'#000000')};D._drawUnit=function(){var a=D.options.unit;if(!a.content){return}var b=D._computeOptions();var c=b.centerY-b.radius*b.unit.distance+b.unit.fontsize/3;if(a.backcolor||a.borderwidth){var d=dcharttools.measureText(D.ctx,a.content,a.fontweight,b.unit.fontsize,a.fontfamily);var e=b.centerX-d/2-b.unit.fontsize/4;var f=c-b.unit.fontsize;dcharttools.createRect(D.ctx,e,f,d+b.unit.fontsize/2,b.unit.fontsize*4/3,a.backcolor,a.borderwidth,a.bordercolor)}dcharttools.createText(D.ctx,a.content,b.centerX,c,'center',a.fontweight,b.unit.fontsize,a.fontfamily,a.fontcolor)};D._drawCurrentValue=function(){var a=D.options.currentValue;if(!D._configs._nextval||!a.show||typeof a.content!='function'){return}var b=D._computeOptions();var c=b.centerY+b.radius*b.currentValue.distance+b.currentValue.fontsize/3;var d=a.content(D._configs._nextval);if(a.backcolor||a.borderwidth){var e=dcharttools.measureText(D.ctx,d,a.fontweight,b.currentValue.fontsize,a.fontfamily);var f=b.centerX-e/2-b.currentValue.fontsize/4;var g=c-b.currentValue.fontsize;dcharttools.createRect(D.ctx,f,g,e+b.currentValue.fontsize/2,b.currentValue.fontsize*4/3,a.backcolor,a.borderwidth,a.bordercolor)}dcharttools.createText(D.ctx,d,b.centerX,c,'center',a.fontweight,b.currentValue.fontsize,a.fontfamily,a.fontcolor)};D._drawWarning=function(){var b=D._computeOptions();var c=D.options.warning;var d=D.options.animationSteps;var e=c.warningframes;var f=c.thresholdmin!=null&&D._configs._currentval<=c.thresholdmin;var g=c.thresholdmax!=null&&D._configs._currentval>=c.thresholdmax;if(f||g){if(D._configs._isWarning){D.disarmWarning()}D._configs._isWarning=true;D._configs._warningHandler=setInterval(function(){if(!D._configs._isRunning){if(D._configs._warningCount<e){D._drawCanvasBackround()}else{D._drawValue(D._configs._currentval);var a=b.centerY+(c.locatetop?-b.radius*b.warning.distance:b.radius*b.warning.distance)+b.warning.fontsize/3;dcharttools.createText(D.ctx,f?c.contentmin:c.contentmax,b.centerX,a,'center',c.fontweight,b.warning.fontsize,c.fontfamily,c.fontcolor||'#ff0000')}D._configs._warningCount++;if(D._configs._warningCount>e*2){D._configs._warningCount=0}}},1000/d)}else{D.disarmWarning()}};D._drawValue=function(a){D._drawCanvasBackround();D._drawBackground();D._drawCalibration();D._drawUnit();D._drawCurrentValue();D._drawPointer(a)};D.disarmWarning=function(){if(D._configs._warningHandler!=null){D._configs._isWarning=false;clearInterval(D._configs._warningHandler);D._drawValue(D._configs._currentval)}};D.setOptions=function(a){D.options=dcharttools.funcs._override(D.options,a)};D.draw=function(f){D._computeOptions(true);if(D.options.animation){var g=(D.options.animationTime||1)*1000;var h=D.options.animationSteps||24;if(g>1000){throw new Error("animationTime should not be bigger than 1!");}if(h>50){throw new Error("animationSteps should not be bigger than 50!");}D._configs._unfinished.push(f);var i=function(a){D._configs._currentval=a;D._drawWarning();if(D._configs._unfinished.length>1){D._configs._unfinished=D._configs._unfinished.slice(1);j()}else{D._drawValue(D._configs._currentval);D._configs._unfinished.length=0;D._configs._isRunning=false}};var j=function(){var a=D._configs._unfinished[0];D._configs._nextval=a;var b=D._configs._currentval;var c=(a-b)/h;if(Math.abs(c)<0.000001){i(a)}else{D._configs._isRunning=true;var d=a>=b;var e=setInterval(function(){b+=c;if(Math.abs(b-a)<0.0001||d&&b<=a||!d&&b>=a){D._drawValue(b)}else{clearInterval(e);i(a)}},g/h)}};if(!D._configs._isRunning){j()}}else{D._configs._currentval=f;D._configs._nextval=f;D._drawValue(f)}};D._initial();return D}