if(!window.DChart){throw new Error('未能加载dragonchart.core.js，该js必须在其他DChart框架的js加载之前被引用。\n'+'Not loaded dragonchart.core.js which must be loaded before other DChart\'s js.');}else{DChart.Const.Skins.BlackAndWhite.Points={NodeLineColor:'#ffffff',AlignlineLineColor:null}}DChart.Points=DChart.getCore().__extends({GraphType:'Points'});DChart.Points._spreadSkin=function(a,b){a.node={};a.alignline={};a.node.linecolor=b.NodeLineColor||null;a.alignline.linecolor=b.AlignlineLineColor||null};DChart.Points._getDefaultOptions=function(e){var f=DChart.Methods.Extend(e,{invertAxis:false,labelAxis:{valueType:null,content:function(a){if(this.valueType=='d'){return a.format('yyyy-MM-dd')}else if(this.valueType=='t'){return a.format('MM-dd hh:mm')}else{return a.toString()}},minvalue:null,maxvalue:null,interval:null,sort:true},node:{colors:null,nodetype:null,linecolor:null,linewidth:null,length:null,fillcolor:null},tip:{merge:false,spotdistance:10,content:function(a,b){if(b){var c='<div>';for(var i=0;i<a.length;i++){var d=this.valueType=='p'?a[i].vpercent.toFixed(2)+'%':a[i].vvalue.toString();c+=(i>0?'<br/>':'')+a[i].text+" : "+d}c+='&nbsp;</div>';return c}else{var d=this.valueType=='p'?a.vpercent.toFixed(2)+'%':a.vvalue.toString();if(this.valueType=='d'){d=a.vvalue.format('yyyy-MM-dd')}else if(this.valueType=='t'){d=a.vvalue.format('MM-dd hh:mm')}return'<div>&nbsp;'+(a.text?a.text+'：':'')+d+'&nbsp;</div>'}}},alignline:{verticalline:true,horizontalline:true,linecolor:null},scale:{drawvertical:true}});return f};DChart.Points._getCheckOptions=function(){return{__top:[['invertAxis','b']],labelAxis:[['valueType','s'],['content','f'],['interval','n'],['sort','b']],node:[['colors','ca'],['nodetype','s'],['linecolor','c'],['linewidth','n'],['length','n'],['fillcolor','c']],tip:[['merge','b'],['spotdistance','n']],alignline:[['verticalline','b'],['horizontalline','b'],['linecolor','c']],scale:[['drawvertical','b']]}};DChart.Points._drawgraphic=function(v,w,z,A){v._configs.recreateAssists=true;var B=A.invertAxis;var C=w==v.ID;if(C){v._configs.invertAxis=B;if(A.labelAxis.valueType=='p'){throw new Error(v._messages.WrongParam+v._messages.LabelAxisValueTypeCannotBePercent);}}var D=v._formatAxisData();var E=v._calculateOutersValid();var F=v._computeAxis(E);var G=v._getDrawableCoordinate();if(!v.coordinates.line){v.coordinates.line={}}v.coordinates.line[w]={nodes:[]};v.shapes[w]={nodes:[]};var H=A.labelAxis.valueType;var I=D.vValueType=='p';var J=DChart.Methods.IsNumber(A.tip.spotdistance)&&A.tip.spotdistance>0?A.tip.spotdistance:10;var K=A.alignline.linecolor||DChart.Const.Defaults.AlignLineColor;var L=(A.node.colors&&A.node.colors.length>0?A.node.colors:null)||DChart.Const.Defaults.FillColors;if(C){v.coordinates.draw=G;v._configs.legendColors=L}var M=v._configs.specificConfig[w];var N=v._configs.pointsPosition;M.mergeTips=[];var O=(B?F.maxX-F.minX:F.maxY-F.minY);var P=(B?F.maxY-F.minY:F.maxX-F.minX);var Q=A.node.length||DChart.Methods.CapValue(P/100,10,6);var R=function(d,f,g,h,i,j){this.index=d;this.centerX=f;this.centerY=g;this.color=j;this.isHovered=false;this.nodelength=h;this.data=i;this.click=function(e){var a=typeof this.data.click=='function'?this.data.click:(A.click||null);if(a){a(this.data,e)}};if(A.tip.show&&typeof A.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=this.centerX+Q+5;var b=this.centerY-Q-10;this.tip=v._createTip(A.tip.content.call(A,this.data,false),a,b);if(this.centerX+this.tip.clientWidth>F.maxX){v._changeTip(this.tip,a-5-Q-this.tip.clientWidth)}var c=this;c.tip.onclick=function(e){c.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var S=function(x,y,a,b){var c=A.node;var d=b.nodelength||Q;var e=b.nodetype||c.nodetype||'c';var f=b.nodelinecolor||c.linecolor||a;var g=b.nodelinewidth||c.linewidth;v.DrawFigures.createPointElement(e,x,y,d,a,true,f,g,true,true)};var T=function(l,m){var n=function(a){var b=(A.animation?l:1)*O*v._getFormatDiff(D.vValueType,D.vMinValue,a)/v._getFormatDiff(D.vValueType,D.vMinValue,D.vMaxValue);return b};var o=function(a){if(H){return P*v._getFormatDiff(D.lValueType,D.lMinValue,a)/v._getFormatDiff(D.lValueType,D.lMinValue,D.lMaxValue)}else{if(D.multiple){return P*a/(z[0].value.length-1)}else{if(C){return P*a/(z.length-1)}else{return F.labelDistance*a}}}};var p=function(i,a,x,y,b,c,d,e,f,g,h){if(m>=1){var j={vvalue:d,lvalue:e,text:f,click:h.click,mouseover:h.mouseover,mouseleave:h.mouseleave,nodetype:h.nodetype,nodelength:h.nodelength,nodelinecolor:h.nodelinecolor,nodelinewidth:h.nodelinewidth,nodefillcolor:h.nodefillcolor};if(g!=null){j.vpercent=g}var k=new R(a,x,y,b,j,c);v.shapes[w].nodes.push(k);if(i>=0){v.coordinates.line[w][i][a]={centerX:x,centerY:y,length:b}}else{v.coordinates.line[w][a]={centerX:x,centerY:y,length:b}}}};var q,vvalue,vpercent,center1,center2;if(D.multiple){for(var i=0,dataitem;dataitem=z[i];i++){var r=dataitem.text||'';var s=dataitem.color||L[i%L.length];var t=dataitem.nodetype;if(m>=1){v.coordinates.line[w][i]=[]}for(var k=0;k<dataitem.value.length;k++){u=dataitem.value[k];q=H?u[0]:k;vvalue=H?u[1]:u;vpercent=I?dataitem.percent[k]:null;center2=B?F.minX+n(I?vpercent:vvalue):F.maxY-n(I?vpercent:vvalue);if(N){center1=N[i]+(B?-N.labelDistance*k:N.labelDistance*k)}else{center1=(B?F.maxY-o(q):F.minX+o(q))}S(B?center2:center1,B?center1:center2,s,dataitem);p(i,k,B?center2:center1,B?center1:center2,dataitem.nodelength||Q,s,vvalue,q,r,vpercent,dataitem)}}}else{for(var i=0;i<z.length;i++){var u=z[i];var r=u.text||'';var s=u.color||(A.node.colors&&A.node.colors.length>0?L[i%L.length]:null)||A.node.fillcolor||'#000000';q=H?u.value[0]:i;vvalue=H?u.value[1]:u.value;vpercent=I?z[i].percent:null;center1=C?(B?F.maxY-o(q):F.minX+o(q)):F.startPos+(B?-o(q):o(q));center2=B?F.minX+n(I?vpercent:vvalue):F.maxY-n(I?vpercent:vvalue);S(B?center2:center1,B?center1:center2,s,u);p(-1,i,B?center2:center1,B?center1:center2,u.nodelength||Q,s,vvalue,q,r,vpercent,u)}}};var U=function(){var p=function(x,y){var a=null;for(var i=v.shapes[w].nodes.length-1;i>=0;i--){var b=v.shapes[w].nodes[i];if(Math.sqrt(Math.pow(x-b.centerX,2)+Math.pow(y-b.centerY,2))<=b.nodelength/2){a=b;break}}return a};var q=function(x,y){var a=[];var b=0;if(y<=F.maxY&&y>=F.minY&&x>=F.minX&&x<=F.maxX){var c=-1;var d=P/(D.tuftCount-1);var e=(B?F.maxY:F.minX);var f=(B?y:x);for(var i=1;i<D.tuftCount;i++){var g=e+(B?-i*d:(i-1)*d);var h=e+(B?-(i-1)*d:i*d);if(g<=f&&h>=f){var j=Math.abs(g-f);var k=Math.abs(h-f);if(j<J&&j<=k){c=B?i:i-1;b=g}else if(k<J&&k<=j){c=B?i-1:i;b=h}break}}for(var i=0,shape;shape=v.shapes[w].nodes[i];i++){if(shape.index==c){a.push(shape)}}}return{shapes:a,loc:b}};var r=function(e){var e=window.event||e;var a=v._getMouseLoction(e);var b=p(a.X,a.Y);if(b){b.click(e)}};var s=function(e){var e=window.event||e;var a=v._getMouseLoction(e);var b=N||D.lValueType||!D.multiple;var c=p(a.X,a.Y);if(c){v._configs.cursorPointer=true}if(M.currentMouseShape!=c){var d=M.currentMouseShape;if(d){var f=typeof d.data.mouseleave=='function'?d.data.mouseleave:(A.mouseleave||null);if(f){f(d.data,e)}}M.currentMouseShape=c;for(var i=0,d;d=v.shapes[w].nodes[i];i++){if(d!=c&&d.isHovered){d.isHovered=false;if(b&&d.hideTip){d.hideTip()}}}if(c){c.isHovered=true;if(A.alignline.verticalline||A.alignline.horizontalline){v.redrawAll()}if(A.alignline.verticalline){v.DrawFigures.createLine(c.centerX,F.minY,c.centerX,F.maxY+1,1,K)}if(A.alignline.horizontalline){v.DrawFigures.createLine(F.minX,c.centerY,F.maxX,c.centerY,1,K)}if(c.showTip&&b){c.showTip()}var g=typeof c.data.mouseover=='function'?c.data.mouseover:(A.mouseover||null);if(g){g(c.data,e)}}else{if(b&&(A.alignline.verticalline||A.alignline.horizontalline)){v.redrawAll()}}}if(!b){var h=q(a.X,a.Y);if(v.loc!=h.loc){v.loc=h.loc;if(A.tip.merge){for(var i=0;i<M.mergeTips.length;i++){if(M.mergeTips[i]){M.mergeTips[i].style.display='none'}}}else{for(var i=0,d;d=v.shapes[w].nodes[i];i++){if(d.hideTip){d.hideTip()}}}if(B&&A.alignline.horizontalline||!B&&A.alignline.verticalline){v.redrawAll()}if(h.shapes.length){if(!B&&A.alignline.verticalline){v.DrawFigures.createLine(h.loc,F.minY,h.loc,F.maxY+1,1,K)}if(B&&A.alignline.horizontalline){v.DrawFigures.createLine(F.minX,h.loc,F.maxX,h.loc,1,K)}if(A.tip.merge){if(h.shapes[0].showTip){var j=M.mergeTips[h.shapes[0].index];if(!j){var k=[];var l=0;var m=0;for(var i=0,d;d=h.shapes[i];i++){k.push(d.data);m+=d.centerY;l+=d.centerX}var n=l/h.shapes.length+5;var o=m/h.shapes.length;j=v._createTip(A.tip.content.call(A,k,true),n,o);v._changeTip(j,null,o-j.clientHeight/2+10);if(n+j.clientWidth>F.maxX){v._changeTip(j,n-5-Q-j.clientWidth)}M.mergeTips[h.shapes[0].index]=j}j.style.display='inline'}}else{for(var i=0,d;d=h.shapes[i];i++){if(d.showTip){d.showTip()}}}}}}};v._addEventListener('click',r);v._addEventListener('mousemove',s)};var V=function(){var a,centerY=null;for(var i=0;i<v.shapes[w].nodes.length;i++){var b=v.shapes[w].nodes[i];S(b.centerX,b.centerY,b.color,b.data)}};return{drawSegments:T,mouseEvents:U,redraw:V}};