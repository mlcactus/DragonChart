if(!window.DChart){throw new Error('未能加载dragonchart.core.js，该js必须在其他DChart框架的js加载之前被引用。\n'+'Not loaded dragonchart.core.js which must be loaded before other DChart\'s js.');}else{DChart.Const.Skins.BlackAndWhite.NestedPie3D={SeparateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:'rgba(255,255,255,0.3)'}}DChart.NestedPie3D=DChart.getCore().__extends({GraphType:'NestedPie3D'});DChart.NestedPie3D._spreadSkin=function(a,b){a.separateLine={};a.innerLabel={};a.outerLabel={};a.separateLine.color=b.SeparateLineColor||null;a.innerLabel.color=b.InnerLabelColor||null;a.outerLabel.color=b.OuterLabelColor||null;a.outerLabel.bordercolor=b.OuterLabelBorderColor||null;a.outerLabel.backcolor=b.OuterLabelBackColor||null};DChart.NestedPie3D._getDefaultOptions=function(b){var c=DChart.Methods.Extend(b,{offX:0,offY:0,innerRadius:null,outerRadius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,reflection3d:{reflectoffX:null,reflectoffY:null,zoomX:null,zoomY:null},subitems:{outerlabalpoint:null,innerlabalpoint:null,inheritevents:true,showinnerlabels:false},separateLine:{color:null,width:null},innerLabel:{show:true,content:function(a){return a.percent.toFixed(1)+'%'},distance:null,color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(a){return a.text+' '+a.percent.toFixed(1)+'%'},withlegend:true,legendtype:null,length:null,color:null,backcolor:'rgba(255,255,255,0.3)',bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null}});return c};DChart.NestedPie3D._getCheckOptions=function(){return{__top:[['offX','n'],['offX','n'],['innerRadius','n'],['outerRadius','n'],['margin','n'],['colors','ca'],['animateRotate','b'],['animateScale','b'],['startAngle','n']],subitems:[['outerlabalpoint','n'],['innerlabalpoint','n'],['inheritevents','b'],['showinnerlabels','b']],separateLine:[['color','c'],['width','n']],innerLabel:[['show','b'],['content','f'],['distance','n'],['color','c'],['fontsize','n'],['fontfamily','s']],outerLabel:[['show','b'],['content','f'],['withlegend','b'],['legendtype','s'],['length','n'],['backcolor','c'],['bordercolor','c'],['borderwidth','n'],['color','c'],['fontsize','n'],['fontfamily','s']]}};DChart.NestedPie3D._drawgraphic=function(H,I,J,K){var L=3;var M=3;var N=K.reflection3d.zoomX||1.2;var O=K.reflection3d.zoomY||0.9;var P=H._computeRadiusForPies(K,N,O);var Q=!K.outerRadius||!DChart.Methods.IsNumber(K.outerRadius)?P.maxRadius:K.outerRadius;var R=K.innerRadius&&K.innerRadius>Q*0.1&&K.innerRadius<Q?K.innerRadius:Q*0.7;if(Q<=R){throw new Error(H._messages.WrongSet+H._messages.OuterRadiusShouldBigger);}var S=K.reflection3d.reflectoffX||0;var T=K.reflection3d.reflectoffY||Q/6;var U=K.separateLine.width||1;var V=K.separateLine.color||'#ffffff';var W=Math.PI*(K.startAngle==null?-0.5:K.startAngle);var X=I==H.ID;var Y=(K.colors&&K.colors.length>0?K.colors:null)||DChart.Const.Defaults.FillColors;if(X){H.coordinates.draw=P.coordinate;H._configs.legendColors=Y}if(!H.coordinates.nestedpie){H.coordinates.nestedpie={}}H.coordinates.nestedpie[I]={outerRadius:Q,innerRadius:R,centerX:P.centerX,centerY:P.centerY,cemicircles:[],outerlabels:[]};H.shapes[I]={cemicircles:[],outerlabels:[]};var Z=H.shapes[I];var ba=0;var bb=[];var bc=[];var bd=[];for(var i=0,item;item=J[i];i++){var be=item.value;if(typeof be!='number'||be<0){throw new Error(H._messages.WrongData+'\''+be+'\''+H._messages.DataMustGreaterThanZero);}ba+=be;bb[i]=be;var bf=item.subitems;if(DChart.Methods.IsArray(bf)){bc[i]=true;var bg=0;for(var j=0,subitem;subitem=bf[j];j++){var bh=subitem.value;bd.push(bh);if(typeof bh!='number'||bh<0){throw new Error(H._messages.WrongData+'\''+bh+'\''+H._messages.DataMustGreaterThanZero);}bg+=bh}if(!(Math.abs(bg-be)<0.00001)){throw new Error(H._messages.WrongData+'\''+be+'\''+H._messages.SubItemsValueShouldEqualSuperValue);}}else{bc[i]=false}}var bi=true;var bj=K.subitems.inheritevents;var bk=K.subitems.showinnerlabels;var bl=H._configs.specificConfig[I];var bm=K.subitems.outerlabalpoint;var bn=K.subitems.innerlabalpoint;if(bm==null||bn==null){if(bd.length>8){bd.sort(function(x,y){return y-x});var bo=bd[8];if(bm==null){bm=bo}if(bn==null){bn=bo}}}var bp=function(f,g,h,i){var j=(h+i)/2;var k=P.centerX;var l=P.centerY;var m=Math.cos(j);var n=Math.sin(j);var o=k+S;var p=l+T;var q=R*g;var r=Q*g;var s=function(a,b,c){var d=a==0?k:(a==1?l:(a==2?o:p));var e=a==0||a==2?Math.cos:Math.sin;return d+e(b?i:h)*(c?r:q)};var t={isInnerPie:f,midAngle:j,angleMin:h,angleMax:i,innerRadius:q,outerRadius:r,centerX:k,centerY:l,darkCenterX:o,darkCenterY:p,iStartX:s(0,0,0),iStartY:s(1,0,0),iEndX:s(0,1,0),iEndY:s(1,1,0),d_iStartX:s(2,0,0),d_iStartY:s(3,0,0),d_iEndX:s(2,1,0),d_iEndY:s(3,1,0)};if(!f){t.oStartX=s(0,0,1);t.oStartY=s(1,0,1);t.oEndX=s(0,1,1);t.oEndY=s(1,1,1);t.d_oStartX=s(2,0,1);t.d_oStartY=s(3,0,1);t.d_oEndX=s(2,1,1);t.d_oEndY=s(3,1,1)}return t};var bq=function(g,h,j,k,l,m,n,o,p,q){this.indexX=g;this.indexY=h;this.percent=j;this.color=k;this.angleMin=l;this.angleMax=m;this.midAngle=n;this.isLeft=o;this.isBottom=p;this.data=q;this.isHovered=false;this.isInnerPie=h==null;this.redraw=function(a){var b=a;for(var i=0;i<4;i++){bs(this.isInnerPie,i,1,this.angleMin,this.angleMax,a||this.color,b,b?a:this.data.darksidecolor)}};this.contact=null;this.superShape=null;this.computeinfo=function(a){if(!this._computeinfo||a){this._computeinfo=bp(this.isInnerPie,1,this.angleMin,this.angleMax)}return this._computeinfo};this.click=function(e,a){var b=typeof this.data.click=='function'?this.data.click:(K.click||null);if(b){b(a||this.data,e)}else if(bj&&this.superShape){this.superShape.click(e,this.data)}};this.mouseover=function(e,a){var b=typeof this.data.mouseover=='function'?this.data.mouseover:(K.mouseover||null);if(b){b(a||this.data,e)}else if(bj&&this.superShape){this.superShape.mouseover(e,this.data)}};this.mouseleave=function(e,a){var b=typeof this.data.mouseleave=='function'?this.data.mouseleave:(K.mouseleave||null);if(b){b(a||this.data,e)}else if(bj&&this.superShape){this.superShape.mouseleave(e,this.data)}};if(K.tip.show&&typeof K.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=(this.angleMin+this.angleMax)/2;var b=this.isInnerPie?R:(Q+R);var c=P.centerX+b/2*Math.cos(a);var d=P.centerY+b/2*Math.sin(a);this.tip=H._createTip(K.tip.content(this.data),c*N,d*O);var f=this;f.tip.onclick=function(e){f.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var br=function(h,i,j,k,l,m,n,o){this.content=h;this.length=i;this.width=j;this.height=k;this.floatright=l;this.floattop=m;this.data=n;this.contact=o;this.color=this.contact.color;this.index=this.contact.index;this.resetposition=function(){var a=this.length;var b=1.15;var c=this.contact.computeinfo();var d=Math.cos(c.midAngle);var e=Math.sin(c.midAngle);var f=d>0?1+d:0;var g=e>0?e:0;this.startX=(m?c.centerX:(c.centerX+c.darkCenterX)/2)+Q*d;this.startY=(m?c.centerY:(c.centerY+c.darkCenterY)/2)+Q*e;this.left=(m?c.centerX:c.darkCenterX)+Q*b*d+(this.floatright?0:-this.width);this.top=(m?c.centerY:c.darkCenterY)+Q*b*e+g*a-a-M};this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2}};var bs=function(a,b,c,d,e,f,g,h,i,j){var k=bp(a,c,d,e);h=h||DChart.Methods.getDarkenColor(f);var l=g?0:U;H.ctx.save();H.ctx.transform(N,0,0,O,0,0);switch(b){case 0:if(a){H.DrawFigures.createArc(k.darkCenterX,k.darkCenterY,k.innerRadius,0,null,h,d,e,true)}else{H.DrawFigures.createRingReflection(k,h,l,V)}break;case 1:if(a){H.DrawFigures.createCloseFigure([[k.darkCenterX,k.darkCenterY],[k.centerX,k.centerY],[k.iEndX,k.iEndY],[k.d_iEndX,k.d_iEndY]],h)}else{H.DrawFigures.createCloseFigure([[k.iStartX,k.iStartY],[k.d_iStartX,k.d_iStartY],[k.d_oStartX,k.d_oStartY],[k.oStartX,k.oStartY]],h)}break;case 2:if(a){H.DrawFigures.createCloseFigure([[k.darkCenterX,k.darkCenterY],[k.centerX,k.centerY],[k.iStartX,k.iStartY],[k.d_iStartX,k.d_iStartY]],h)}else{H.DrawFigures.createCloseFigure([[k.iEndX,k.iEndY],[k.d_iEndX,k.d_iEndY],[k.d_oEndX,k.d_oEndY],[k.oEndX,k.oEndY]],h)}break;default:if(a){H.DrawFigures.createArc(k.centerX,k.centerY,k.innerRadius,l,V,f,d,e,true)}else{H.DrawFigures.createRing(k.centerX,k.centerY,k.innerRadius,k.outerRadius,f,d,e,l,V)}break}H.ctx.restore();var m=K.outerLabel;if(i&&m.show&&typeof m.content=='function'&&((!a&&(bm==null||i.value>bm))||(a&&!bc[j.indexX]))){var n=(d+e)/2;var o=m.length||Q/12;var p=DChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,n);var q=DChart.Methods.JudgeBetweenAngle(-Math.PI,0,n);var r=m.content(i);var s=H.DrawFigures.measureText(r,null,m.fontsize||(o-1),m.fontfamily);var t=s+(m.withlegend?o+3*L:2*L);var u=o+M*2;var v=new br(r,o,t,u,p?1:0,q?1:0,i,j);Z.outerlabels.push(v);j.contact=v}};var bt=function(j){var k=K.innerLabel;if(!(k.show&&typeof k.content=='function')){return}var l=k.distance||0.5;var m=function(a){var b=a.isInnerPie;var c=!a.isInnerPie&&bk&&(bn==null||a.data.value>bn);if(b||c){var d=(a.angleMin+a.angleMax)/2;var e=a.data;var f=b?(R+Q)/2*l:R+(Q-R)*l;var g=P.centerX+f*Math.cos(d);var h=P.centerY+f*Math.sin(d);H.ctx.save();H.ctx.transform(N,0,0,O,0,0);H.DrawFigures.createText(k.content(e),g,h,'center',e.fontweight,e.fontsize||k.fontsize||Q/10,k.fontfamily,e.fontcolor||k.color||DChart.Const.Defaults.InnerLabelColor);H.ctx.restore()}};if(j){m(j)}else{for(var i=0,shape;shape=Z.cemicircles[i];i++){m(shape)}}};var bu=function(l,m){var n=K.outerLabel;if(!(n.show&&typeof n.content=='function')){return}var o=(X?P.coordinate.minY:5)/O;var p=(X?P.coordinate.maxY:H.canvas.height-5)/O;Z.outerlabels.sort(function(a,b){return a.index-b.index});if(bi){for(var i=0,shape;shape=Z.outerlabels[i];i++){shape.resetposition()}bi=false}var q=function(){var c=function(a,b){return Math.max(a.left,b.left)<=Math.min(a.left+a.width,b.left+b.width)&&Math.max(a.top,b.top)<=Math.min(a.top+a.height,b.top+b.height)};var d=[];var e=[];var f=[];var g=[];for(var i=0,shape;shape=Z.outerlabels[i];i++){while(o>shape.top){shape.top+=M;shape.left+=shape.floatright?L:-L}while(p<shape.top+shape.height){shape.top-=M;shape.left+=shape.floatright?L:-L}if(shape.floatright&&shape.floattop){f.push(shape)}else if(shape.floatright&&!shape.floattop){g.push(shape)}else if(!shape.floatright&&shape.floattop){d.push(shape)}else{e.push(shape)}}var h=0;var j=[];var k=function(r){if(j.length>0){for(var i=0,compare;compare=j[i];i++){while(c(compare,r)&&h<1000){r.top+=r.floattop?M:-M;r.left+=r.floatright?L:-L;h++}}}j.push(r)};for(var i=d.length-1;i>=0;i--){k(d[i])}j=[];for(var i=0;i<e.length;i++){k(e[i])}j=[];for(var i=0;i<f.length;i++){k(f[i])}j=[];for(var i=g.length-1;i>=0;i--){k(g[i])}};var s=function(a,b){var c=a;H.ctx.save();H.ctx.transform(N,0,0,O,0,0);if(!b){H.DrawFigures.createQuadraticCurve(c.startX,c.startY,c.startX*0.8+c.endX()*0.2,c.startY*0.2+c.endY()*0.8,c.endX(),c.endY(),1,n.bordercolor);if(n.backcolor){H.DrawFigures.createRectangleFill(c.left,c.top,c.width,c.height,n.backcolor)}var d=c.left+(c.floatright?L+(n.withlegend?c.length+L:0):c.width-L);var e=c.top+c.length+M/2;H.DrawFigures.createText(c.content,d,e,c.floatright?'left':'right',null,n.fontsize||(c.length-1),n.fontfamily,n.color);if(n.borderwidth&&n.borderwidth>0){H.DrawFigures.createRectangleBorder(c.left,c.top,c.width,c.height,n.borderwidth,n.bordercolor)}}if(n.withlegend){var f=n.legendtype||'s';var b=b||c.color;H.DrawFigures.createPointElement(f,c.left+L,c.top+M,c.length,b,f!='x',b,2,f=='x')}H.ctx.restore()};if(l){if(l.contact){s(l.contact,m)}}else{q();H.coordinates.nestedpie[I].outerlabels.length=0;for(var i=0,shape;shape=Z.outerlabels[i];i++){s(shape);H.coordinates.nestedpie[I].outerlabels[i]={left:shape.left,top:shape.top,width:shape.width,height:shape.height}}}};var bv=function(){var e=function(a,b,c,d){bs(a.isInnerPie,b,1,a.angleMin,a.angleMax,a.color,false,a.data.darksidecolor)};for(var i=0,shapeitem;shapeitem=Z.cemicircles[i];i++){e(shapeitem,0);e(shapeitem,1);e(shapeitem,2)}for(var i=0,shapeitem;shapeitem=Z.cemicircles[i];i++){e(shapeitem,3)}bt();bu()};var bw=function(e,f){var g=W;var h=g;var k=K.animation&&K.animateScale?e:1;var l=K.animation&&K.animateRotate?e:1;var m=f>=1;var n=[];for(var i=0,item;item=J[i];i++){var o=(item.value/ba)*100;var p=l*(o/100*(Math.PI*2));var q=item.color||Y[i%Y.length];var r=g;var s=g+p;var t=(r+s)/2;var u=DChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,t);var v=DChart.Methods.JudgeBetweenAngle(r,s,Math.PI/2);if(m){item.percent=o;H.coordinates.nestedpie[I].cemicircles.push({indexX:i,indexY:null,percent:o,radius:R,angleMin:r,angleMax:s,color:q})}var w=new bq(i,null,o,q,r,s,t,u,v,item);n.push(w);g+=p;var x=item.subitems;if(x&&DChart.Methods.IsArray(x)){for(var j=0,subitem;subitem=x[j];j++){var y=(subitem.value/ba)*100;var z=l*(y/100*(Math.PI*2));var A=h;var B=h+z;var C=(A+B)/2;var D=DChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,C);var E=DChart.Methods.JudgeBetweenAngle(A,B,Math.PI/2);var F=subitem.color||item.subcolor||q;if(m){subitem.percent=y;subitem.subpercent=(subitem.value/bb[i])*100;H.coordinates.nestedpie[I].cemicircles.push({indexX:i,indexY:j,percent:y,innerRadius:R,outerRadius:Q,angleMin:A,angleMax:B,color:F})}var w=new bq(i,j,o,F,A,B,C,D,E,subitem);n.push(w);h+=z}}else{h+=p}}n.sort(function(a,b){if(a.isInnerPie!=b.isInnerPie){if(a.isInnerPie){return-1}else{return 1}}else{if(a.isBottom){return 1}else if(b.isBottom){return-1}else{if(a.isLeft==b.isLeft){if(a.isLeft){return a.midAngle<b.midAngle?-1:1}else{return a.midAngle<b.midAngle?1:-1}}else{if(a.isLeft){return-1}else{return 1}}}}});var G=function(a,b,c,d){bs(a.isInnerPie,b,k,a.angleMin,a.angleMax,a.color,false,a.data.darksidecolor,m&&b==3?a.data:null,m&&b==3?a:null)};for(var i=0,shapeitem;shapeitem=n[i];i++){G(shapeitem,0);G(shapeitem,1);G(shapeitem,2)}for(var i=0,shapeitem;shapeitem=n[i];i++){G(shapeitem,3)}if(m){Z.cemicircles=n;bt();bu()}};var bx=function(){var m=function(x,y){var a=null;for(var i=0,h;h=Z.cemicircles[i];i++){var b=(h.angleMin+h.angleMax)/2;var c=DChart.Methods.GetCurrentAngle(x,y,P.centerX,P.centerY);var d=Math.pow(x-P.centerX,2)+Math.pow(y-P.centerY,2);var e=(h.isInnerPie&&d<=Math.pow(R,2)||!h.isInnerPie&&d>Math.pow(R,2)&&d<=Math.pow(Q,2))&&DChart.Methods.JudgeBetweenAngle(h.angleMin,h.angleMax,c);var f=false;if(K.outerLabel&&K.outerLabel.show&&h.contact){var g=h.contact;if(x>=g.left&&x<=g.left+g.width&&y>=g.top&&y<=g.top+g.height){f=true}}if(e||f){a=h;break}}if(!a){for(var i=Z.cemicircles.length-1;i>=0;i--){var h=Z.cemicircles[i];var j=h.computeinfo();var d=Math.pow(x-j.darkCenterX,2)+Math.pow(y-j.darkCenterY,2);var k=DChart.Methods.GetCurrentAngle(x,y,j.darkCenterX,j.darkCenterY);var l=(h.isInnerPie&&d<=Math.pow(R,2)||!h.isInnerPie&&d>Math.pow(R,2)&&d<=Math.pow(Q,2))&&DChart.Methods.JudgeBetweenAngle(h.angleMin,h.angleMax,k);if(l){a=h;break}}}return a};var n=function(e){var e=window.event||e;var a=DChart.Methods.tranferLocation(H._getMouseLoction(e),N,O);var b=m(a.X,a.Y);if(b){b.click(e)}};var o=function(e){var e=window.event||e;var a=DChart.Methods.tranferLocation(H._getMouseLoction(e),N,O);var b=m(a.X,a.Y);if(b){H._configs.cursorPointer=true}if(bl.currentMouseShape!=b){var c=bl.currentMouseShape;if(c){c.mouseleave(e)}if(bl.currentMouseShape){H.redrawAll()}bl.currentMouseShape=b;for(var i=0,c;c=Z.cemicircles[i];i++){if(c.isHovered){c.isHovered=false;if(c.hideTip){c.hideTip()}}}if(b){b.isHovered=true;var d=K.mouseoverTransparency;var f='rgba(255,255,255,'+(d>0&&d<1?d:0.2)+')';b.redraw(f);bu(b,f);if(b.showTip){b.showTip()}b.mouseover(e)}}};H._addEventListener('click',n);H._addEventListener('mousemove',o)};return{drawSegments:bw,mouseEvents:bx,redraw:bv}};