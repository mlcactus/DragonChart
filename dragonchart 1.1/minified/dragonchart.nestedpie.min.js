if(!window.DChart){throw new Error('未能加载dragonchart.core.js，该js必须在其他DChart框架的js加载之前被引用。\n'+'Not loaded dragonchart.core.js which must be loaded before other DChart\'s js.');}else{DChart.Const.Skins.BlackAndWhite.NestedPie={SeparateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:'rgba(255,255,255,0.3)'}}DChart.NestedPie=DChart.getCore().__extends({GraphType:'NestedPie',SetDefaultOptions:function(){this._resetSharedOpions();this.innerOptions=DChart.Methods.Extend(this.originalDefaultOptions,{offX:0,offY:0,innerRadius:null,outerRadius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,subitems:{outerlabalpoint:null,innerlabalpoint:null,inheritevents:true,showinnerlabels:false},separateLine:{show:true,color:null,width:null},innerLabel:{show:true,content:function(a){return a.percent.toFixed(1)+'%'},distance:null,color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(a){return a.text+' '+a.percent.toFixed(1)+'%'},withlegend:true,legendtype:null,length:null,color:null,backcolor:'rgba(255,255,255,0.3)',bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null}});return this},Draw:function(z,A){var B=this;if(arguments.length===1){if(!DChart.Methods.IsArray(arguments[0])){A=arguments[0];z=undefined}}B.SetOptions(A);B._checkOptions();var C=B.innerOptions;if(!C.animateRotate&&!C.animateScale){C.animation=false}B.SetData(z);B._onStart();var D=DChart.Const.Language[B.Language];var E=B._computeRadiusForPies(C);var F=C.outerRadius&&C.outerRadius<E.maxRadius?C.outerRadius:E.maxRadius;var G=C.innerRadius&&C.innerRadius>E.maxRadius*0.1&&C.innerRadius<E.maxRadius?C.innerRadius:E.maxRadius*0.7;if(F<=G){throw new Error(D.WrongSet+D.OuterRadiusShouldBigger);}var H=C.separateLine.show?(C.separateLine.width||0.5):0;B.coordinates.draw=E.coordinate;B.coordinates.nestedpie={outerRadius:F,innerRadius:G,centerX:E.centerX,centerY:E.centerY};var I=0;var J=[];var K=[];var L=[];for(var i=0,item;item=B.innerData[i];i++){var M=item.value;if(typeof M!='number'||M<0){throw new Error(D.WrongData+'\''+M+'\''+D.DataMustGreaterThanZero);}I+=M;J[i]=M;var N=item.subitems;if(DChart.Methods.IsArray(N)){K[i]=true;var O=0;for(var j=0,subitem;subitem=N[j];j++){var P=subitem.value;L.push(P);if(typeof P!='number'||P<0){throw new Error(D.WrongData+'\''+P+'\''+D.DataMustGreaterThanZero);}O+=P}if(!(Math.abs(O-M)<0.00001)){throw new Error(D.WrongData+'\''+M+'\''+D.SubItemsValueShouldEqualSuperValue);}}else{K[i]=false}}var Q=(C.colors&&C.colors.length>0?C.colors:null)||DChart.Const.Defaults.FillColors;B.tempData.legendColors=Q;B.shapes.cemicircles=[];B.shapes.outerLabels=[];B.coordinates.nestedpie.cemicircles=[];B.coordinates.nestedpie.outerlabels=[];var R=3;var S=3;var T=true;var U=C.subitems.outerlabalpoint;var V=C.subitems.innerlabalpoint;if(U==null||V==null){if(L.length>8){L.sort(function(x,y){return y-x});var W=L[8];if(U==null){U=W}if(V==null){V=W}}}var X=C.subitems.inheritevents;var Y=C.subitems.showinnerlabels;var Z=function(g,h,i,j,k){this.indexX=g;this.indexY=h;this.angleMin=i;this.angleMax=j;this.data=k;this.isHovered=false;this.isInnerPie=function(){return this.indexY==null};this.color=function(){return this.data.color||(this.isInnerPie()?Q[this.indexX%Q.length]:this.superShape.data.subcolor||this.superShape.color())};this.redraw=function(a){bb(1,!this.isInnerPie(),this.angleMin,this.angleMax,a||this.color())};this.contact=null;this.superShape=null;this.click=function(e,a){var b=typeof this.data.click=='function'?this.data.click:(C.click||null);if(b){b(a||this.data,e)}else if(X&&this.superShape){this.superShape.click(e,this.data)}};this.mouseover=function(e,a){var b=typeof this.data.mouseover=='function'?this.data.mouseover:(C.mouseover||null);if(b){b(a||this.data,e)}else if(X&&this.superShape){this.superShape.mouseover(e,this.data)}};this.mouseleave=function(e,a){var b=typeof this.data.mouseleave=='function'?this.data.mouseleave:(C.mouseleave||null);if(b){b(a||this.data,e)}else if(X&&this.superShape){this.superShape.mouseleave(e,this.data)}};if(C.tip.show&&typeof C.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=(this.angleMin+this.angleMax)/2;var b=this.isInnerPie()?G:(F+G);var c=E.centerX+b/2*Math.cos(a);var d=E.centerY+b/2*Math.sin(a);this.tip=B._createTip(C.tip.content(this.data),c,d);var f=this;f.tip.onclick=function(e){f.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var ba=function(k,l,m,n,o,p,q,r){this.content=k;this.length=l;this.width=m;this.height=n;this.floatright=o;this.floattop=p;this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2};this.data=q;this.contact=r;this.color=function(){return this.contact.color()};this.resetposition=function(){var a=r.isInnerPie()?G:F;var b=this.length;var c=E.centerX;var d=E.centerY;var e=(this.contact.angleMin+this.contact.angleMax)/2;var f=Math.cos(e);var g=Math.sin(e);var h=1.15;var i=f>0?1+f:0;var j=g>0?g:0;this.startX=c+a*f;this.startY=d+a*g;this.left=c+F*h*f+(this.floatright?0:-this.width);this.top=d+F*h*g+j*b-b-S}};var bb=function(a,b,c,d,e,f,g){var h=(c+d)/2;var i=E.centerX;var j=E.centerY;var k=Math.cos(h);var l=Math.sin(h);var m=C.separateLine.show?(C.separateLine.width||1):0;var n=C.separateLine.color;if(b){B.DrawFigures.createRing(i,j,G*a,F*a,e,c,d,m,n)}else{B.DrawFigures.createArc(i,j,G*a,m,n,e,c,d,true)}var o=C.outerLabel;if(f&&o.show&&typeof o.content=='function'&&(b&&(U==null||f.value>U)||!K[f.indexX])){var p=o.length||F/12;var q=DChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,h);var r=DChart.Methods.JudgeBetweenAngle(-Math.PI,0,h);var s=o.content(f);var t=B.DrawFigures.measureText(s,null,o.fontsize||(p-1),o.fontfamily);var u=t+(o.withlegend?p+3*R:2*R);var v=p+S*2;var w=new ba(s,p,u,v,q?1:0,r?1:0,f,g);B.shapes.outerLabels.push(w);g.contact=w}};var bc=function(j){var k=C.innerLabel;if(!(k.show&&typeof k.content=='function')){return}var l=k.distance||0.5;var m=function(a){var b=a.isInnerPie();var c=!a.isInnerPie()&&Y&&(V==null||a.data.value>V);if(b||c){var d=(a.angleMin+a.angleMax)/2;var e=a.data;var f=b?(G+F)/2*l:G+(F-G)*l;var g=E.centerX+f*Math.cos(d);var h=E.centerY+f*Math.sin(d);B.DrawFigures.createText(k.content(e),g,h,'center',e.fontweight,e.fontsize||k.fontsize||F/10,k.fontfamily,e.fontcolor||k.color||DChart.Const.Defaults.InnerLabelColor)}};if(j){m(j)}else{for(var i=0,shape;shape=B.shapes.cemicircles[i];i++){m(shape)}}};var bd=function(l,m){var n=C.outerLabel;if(!(n.show&&typeof n.content=='function')){return}if(T){for(var i=0,shape;shape=B.shapes.outerLabels[i];i++){shape.resetposition()}T=false}var o=function(){var c=function(a,b){return Math.max(a.left,b.left)<=Math.min(a.left+a.width,b.left+b.width)&&Math.max(a.top,b.top)<=Math.min(a.top+a.height,b.top+b.height)};var d=[];var e=[];var f=[];var g=[];for(var i=0,shape;shape=B.shapes.outerLabels[i];i++){while(E.coordinate.minY>shape.top){shape.top+=S;shape.left+=shape.floatright?R:-R}while(E.coordinate.maxY<shape.top+shape.height){shape.top-=S;shape.left+=shape.floatright?R:-R}if(shape.floatright&&shape.floattop){f.push(shape)}else if(shape.floatright&&!shape.floattop){g.push(shape)}else if(!shape.floatright&&shape.floattop){d.push(shape)}else{e.push(shape)}}var h=0;var j=[];var k=function(r){if(j.length>0){for(var i=0,compare;compare=j[i];i++){while(c(compare,r)&&h<1000){r.top+=r.floattop?S:-S;r.left+=r.floatright?R:-R;h++}}}j.push(r)};for(var i=d.length-1;i>=0;i--){k(d[i])}j=[];for(var i=0;i<e.length;i++){k(e[i])}j=[];for(var i=0;i<f.length;i++){k(f[i])}j=[];for(var i=g.length-1;i>=0;i--){k(g[i])}};var p=function(a,b){var c=a;if(!b){B.DrawFigures.createQuadraticCurve(c.startX,c.startY,c.startX*0.8+c.endX()*0.2,c.startY*0.2+c.endY()*0.8,c.endX(),c.endY(),1,n.bordercolor);if(n.backcolor){B.DrawFigures.createRectangleFill(c.left,c.top,c.width,c.height,n.backcolor)}var d=n.fontsize||(c.length-1);var e=c.left+(c.floatright?R+(n.withlegend?c.length+R:0):c.width-R);var f=c.top+c.length/2+d/2+S/2;B.DrawFigures.createText(c.content,e,f,c.floatright?'left':'right',null,d,n.fontfamily,n.color);if(n.borderwidth&&n.borderwidth>0){B.DrawFigures.createRectangleBorder(c.left,c.top,c.width,c.height,n.borderwidth,n.bordercolor)}}if(n.withlegend){var g=n.legendtype||'s';var b=b||c.color();B.DrawFigures.createPointElement(g,c.left+R,c.top+S,c.length,b,g!='x',b,2,g=='x')}};if(l){if(l.contact){p(l.contact,m)}}else{o();B.coordinates.nestedpie.outerlabels.length=0;for(var i=0,shape;shape=B.shapes.outerLabels[i];i++){p(shape);B.coordinates.nestedpie.outerlabels[i]={left:shape.left,top:shape.top,width:shape.width,height:shape.height}}}};var be=function(a,b){var c=Math.PI*(C.startAngle==null?-0.5:C.startAngle);var d=c;var e=C.animation&&C.animateScale?a:1;var f=C.animation&&C.animateRotate?a:1;for(var i=0,item;item=B.innerData[i];i++){var g=(item.value/I)*100;var h=f*(g/100*(Math.PI*2));var k=item.color||Q[i%Q.length];var l=c+h;var m=null;if(b>=1){item.indexX=i;item.indexY=null;item.percent=g;m=new Z(i,null,c,l,item);B.shapes.cemicircles.push(m);bb(e,null,c,l,k,item,m);B.coordinates.nestedpie.cemicircles.push({indexX:i,indexY:null,percent:g,radius:G,angleMin:c,angleMax:l,color:k})}else{bb(e,null,c,l,k)}c+=h;var n=item.subitems;if(n&&DChart.Methods.IsArray(n)){for(var j=0,subitem;subitem=n[j];j++){var o=(subitem.value/I)*100;var p=f*(o/100*(Math.PI*2));var q=d+p;var r=subitem.color||item.subcolor||k;if(b>=1){subitem.indexX=i;subitem.indexY=j;subitem.percent=o;subitem.subpercent=(subitem.value/J[i])*100;var s=new Z(i,j,d,q,subitem);s.superShape=m;B.shapes.cemicircles.push(s);bb(e,true,d,q,r,subitem,s);B.coordinates.nestedpie.cemicircles.push({indexX:i,indexY:j,percent:o,innerRadius:G,outerRadius:F,angleMin:d,angleMax:q,color:r})}else{bb(e,true,d,q,r)}d+=p}}else{d+=h}}if(b>=1){bc();bd()}};var bf=function(){var h=function(x,y){var a=null;for(var i=0,shape;shape=B.shapes.cemicircles[i];i++){var b=(shape.angleMin+shape.angleMax)/2;var c=DChart.Methods.GetCurrentAngle(x,y,E.centerX,E.centerY);var d=Math.pow(x-E.centerX,2)+Math.pow(y-E.centerY,2);var e=(shape.isInnerPie()&&d<=Math.pow(G,2)||!shape.isInnerPie()&&d>Math.pow(G,2)&&d<=Math.pow(F,2))&&DChart.Methods.JudgeBetweenAngle(shape.angleMin,shape.angleMax,c);var f=false;if(C.outerLabel&&C.outerLabel.show&&shape.contact){var g=shape.contact;if(x>=g.left&&x<=g.left+g.width&&y>=g.top&&y<=g.top+g.height){f=true}}if(e||f){a=shape;break}}return a};B.canvas.onclick=function(e){var e=window.event||e;var a=B._getMouseLoction(e);var b=h(a.X,a.Y);if(b){b.click(e)}};B.canvas.onmousemove=function(e){var e=window.event||e;var a=B._getMouseLoction(e);var b=h(a.X,a.Y);if(B.tempData.currentMouseShape!=b){var c=B.tempData.currentMouseShape;if(c){c.mouseleave(e)}B.tempData.currentMouseShape=b;for(var i=0,c;c=B.shapes.cemicircles[i];i++){if(c.isHovered){c.isHovered=false;bd(c,c.color());if(c.hideTip){c.hideTip()}}c.redraw()}bc();if(b){b.isHovered=true;if(C.mouseoverChangeCursor){B.canvas.style.cursor='pointer'}var d=C.mouseoverTransparency;var f='rgba(255,255,255,'+(d>0&&d<1?d:0.2)+')';b.redraw(f);bd(b,f);if(b.showTip){b.showTip()}b.mouseover(e)}else{if(C.mouseoverChangeCursor){B.canvas.style.cursor='auto'}}}}};B._startDrawAndAnimation(be,bf)},_spreadSkin:function(a,b){var c=DChart.Const.Skins;if(c[a]&&c[a].NestedPie){var d=c[a].NestedPie;b.separateLine={};b.innerLabel={};b.outerLabel={};b.separateLine.color=d.SeparateLineColor||null;b.innerLabel.color=d.InnerLabelColor||null;b.outerLabel.color=d.OuterLabelColor||null;b.outerLabel.bordercolor=d.OuterLabelBorderColor||null;b.outerLabel.backcolor=d.OuterLabelBackColor||null}},_getCheckOptions:function(){return{__top:[['innerRadius','n'],['outerRadius','n'],['margin','n'],['colors','ca'],['animateRotate','b'],['animateScale','b'],['startAngle','n']],subitems:[['outerlabalpoint','n'],['innerlabalpoint','n'],['inheritevents','b'],['showinnerlabels','b']],separateLine:[['show','b'],['color','c'],['width','n']],innerLabel:[['show','b'],['content','f'],['distance','n'],['color','c'],['fontsize','n'],['fontfamily','s']],outerLabel:[['show','b'],['content','f'],['withlegend','b'],['legendtype','s'],['length','n'],['backcolor','c'],['bordercolor','c'],['borderwidth','n'],['color','c'],['fontsize','n'],['fontfamily','s']]}}});