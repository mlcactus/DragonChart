if(!window.DChart){throw new Error('未能加载dragonchart.core.js，该js必须在其他DChart框架的js加载之前被引用。\n'+'Not loaded dragonchart.core.js which must be loaded before other DChart\'s js.');}else{DChart.Const.Skins.BlackAndWhite.HeapBar={CutLinecolor:null,InnerLabelColor:null}}DChart.HeapBar=DChart.getCore().__extends({GraphType:'HeapBar',SetDefaultOptions:function(){this._resetSharedOpions();this.innerOptions=DChart.Methods.Extend(this.originalDefaultOptions,{animateY:true,animateX:true,bar:{colors:null,length:null,cutlinecolor:null,cutlinewidth:null},label:{show:true,content:function(a){return this.valueType=='p'?a.percent.toFixed(1)+'%':a.value.toString()},color:null,fontweight:null,fontsize:null,fontfamily:null}});return this},Draw:function(z,A){var B=this;if(arguments.length===1){if(!DChart.Methods.IsArray(arguments[0])){A=arguments[0];z=undefined}}B.SetOptions(A);B._checkOptions();var C=B.innerOptions;var D=DChart.Const.Language[B.Language];if(!C.animateY&&!C.animateX){C.animation=false}B.SetData(z);if(C.valueType&&C.valueType!='n'&&C.valueType!='p'){throw new Error(D.WrongParam+D.ValueTypeMustBeNumberOrPercent);}if(!B.innerData[0].value.length||B.innerData[0].value.length<=1){throw new Error(D.WrongData+D.DataMustBeMultipleArray);}B._onStart();B.tempData.upturnAxis=true;B.tempData.notAllowValueNegative=true;var E=B._formatAxisData(true);var F=B._calculateOutersValid();var G=B._computeAxis(F);var H=B._getDrawableCoordinate();B.coordinates.draw=H;B.shapes.bars=[];var I=function(a,b,c,d,e,f,g){if(!g){B.DrawFigures.createRectangleFill(a,b,c,d,e)}if(f&&C.label.show){var h=C.label;var i=typeof h.content=='function'?h.content.call(C,f):'';if(i){var j=a+c/2;var k=h.fontsize||DChart.Methods.CapValue(c/2,18,11);var l=b+d/2+k/3;var e=h.color||'#ffffff';B.DrawFigures.createText(i,j,l,'center',f.fontweight||h.fontweight,f.fontsize||k,h.fontfamily,f.fontcolor||e)}}};var J=function(d,f,g,h,i,j,k,l,m){this.indexX=d;this.indexY=f;this.left=g;this.top=h;this.width=i;this.height=j;this.data=l;this.lineright=m;this.isHovered=false;this.color=k;this.redrawrect=function(a){I(this.left,this.top,this.width,this.height,a||this.color)};this.redrawtext=function(){I(this.left,this.top,this.width,this.height,k||this.color,this.data,true)};this.click=function(e){var a=typeof this.data.click=='function'?this.data.click:(C.click||null);if(a){a(this.data,e)}};if(C.tip.show&&typeof C.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=this.left+this.width*0.7+5;var b=this.top+this.height/2;this.tip=B._createTip(C.tip.content.call(C,this.data),a,b);if(a+this.tip.clientWidth>G.maxX){B._changeTip(this.tip,a-this.tip.clientWidth-this.width*0.5)}var c=this;c.tip.onclick=function(e){c.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var K=null;var L=(C.bar.colors&&C.bar.colors.length>0?C.bar.colors:null)||DChart.Const.Defaults.FillColors;var M=Math.floor(C.bar.cutlinewidth||0);var N=C.bar.cutlinecolor||'#ffffff';var O=M>0;B.tempData.legendColors=L;var P=E.vValueType=='p';var Q=function(c,d){if(!K){var e=C.bar.length;if(e&&e>0){var f=G.labelDistance*0.8;K=Math.min(e,f)}else{K=G.labelDistance*0.6}}var g=function(a){var b=(C.animateX?c:1)*(G.maxX-G.minX)*B._getFormatDiff(E.vValueType,E.vMinValue,a)/B._getFormatDiff(E.vValueType,E.vMinValue,E.vMaxValue);return b};B.coordinates.bars=[];var h=(C.animateY?c:1)*K;for(var i=0;i<E.tuftCount;i++){var l=G.startPos+G.labelDistance*i-K/2;var m=0;var n=[];var o=[];for(var k=0;k<E.demanCount;k++){var p=B.innerData[k];var q=p.color||L[k%L.length];var r=P?p.percent:p.value;var s=G.minX+m;var t=g(r[i]);m+=t;if(s+t>G.maxX-1){t-=s+t-G.maxX+1;s=G.maxX-1-t}if(k>0){s+=M/2}if(k==E.demanCount-1||k==0){t-=M/2}else{t-=M}if(s<G.minX){s=G.minX}var u=null;if(O&&k<E.demanCount-1){u=s+t+M/2;if(u-M/2-1<G.minX){u=G.minX+M/2+1}n.push(u)}if(d>=1){var v={click:p.click,mouseover:p.mouseover,mouseleave:p.mouseleave,text:p.text,indexX:i,indexY:k,fontsize:p.fontsize,fontcolor:p.fontcolor,fontweight:p.fontweight};if(P){v.percent=r[i];v.value=p.value[i]}else{v.value=r[i]}var w=new J(k,i,s,l,t,h,q,v,u);B.shapes.bars.push(w);o.push(w);w.redrawrect();if(!B.coordinates.bars[i]){B.coordinates.bars[i]=[]}B.coordinates.bars[i][k]={left:s,top:l,width:t,height:h,color:q}}else{I(s,l,t,h,q)}}if(O){for(var j=0;j<n.length;j++){B.DrawFigures.createLine(n[j],l,n[j],l+h,M,N)}}if(d>=1){for(var j=0,w;w=o[j];j++){w.redrawtext()}}}};var R=function(){B._clearDrawable(H);B._createScales(F);for(var i=0,shape;shape=B.shapes.bars[i];i++){shape.redrawrect()}for(var i=0,shape;shape=B.shapes.bars[i];i++){if(shape.lineright!=null){B.DrawFigures.createLine(shape.lineright,shape.top,shape.lineright,shape.top+shape.height,M,N)}}for(var i=0,shape;shape=B.shapes.bars[i];i++){shape.redrawtext()}};var S=function(){var h=function(x,y){var a=null;for(var i=0,shape;shape=B.shapes.bars[i];i++){if(shape.left<=x&&shape.left+shape.width>=x&&shape.top<=y&&shape.top+shape.height>=y){a=shape;break}}return a};B.canvas.onclick=function(e){var e=window.event||e;var a=B._getMouseLoction(e);var b=h(a.X,a.Y);if(b){b.click(e)}};B.canvas.onmousemove=function(e){var e=window.event||e;var a=B._getMouseLoction(e);var b=h(a.X,a.Y);if(B.tempData.currentMouseShape!=b){var c=B.tempData.currentMouseShape;if(c){c.isHovered=false;if(c.hideTip){c.hideTip()}var d=typeof c.data.mouseleave=='function'?c.data.mouseleave:(C.mouseleave||null);if(d){d(c.data,e)}}R();B.tempData.currentMouseShape=b;if(b){b.isHovered=true;if(C.mouseoverChangeCursor){B.canvas.style.cursor='pointer'}var f=C.mouseoverTransparency;b.redrawrect('rgba(255,255,255,'+(f>0&&f<1?f:0.2)+')');if(b.showTip){b.showTip()}var g=typeof b.data.mouseover=='function'?b.data.mouseover:(C.mouseover||null);if(g){g(b.data,e)}}else{if(C.mouseoverChangeCursor){B.canvas.style.cursor='auto'}}}}};B._startDrawAndAnimation(Q,S)},_spreadSkin:function(a,b){var c=DChart.Const.Skins;if(c[a]&&c[a].HeapBar){var d=c[a].HeapBar;b.bar={};b.label={};b.bar.cutlinecolor=d.CutLinecolor||null;b.label.color=d.InnerLabelColor||null}},_getCheckOptions:function(){return{__top:[['animateY','b'],['animateX','b']],bar:[['colors','ca'],['length','n'],['cutlinecolor','c'],['cutlinewidth','n']],label:[['show','b'],['content','f'],['color','c'],['fontweight','s'],['fontsize','n'],['fontfamily','s']]}}});